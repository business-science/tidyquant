<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Aggregates a group of returns by asset into portfolio returns"><title>Aggregates a group of returns by asset into portfolio returns — tq_portfolio • tidyquant</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Aggregates a group of returns by asset into portfolio returns — tq_portfolio"><meta property="og:description" content="Aggregates a group of returns by asset into portfolio returns"><meta property="og:image" content="https://business-science.github.io/tidyquant/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-76139189-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-76139189-2');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tidyquant</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.7.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/TQ00-introduction-to-tidyquant.html">Start</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Financial Workflow</h6>
    <a class="dropdown-item" href="../articles/TQ00-introduction-to-tidyquant.html">Introduction to tidyquant</a>
    <a class="dropdown-item" href="../articles/TQ01-core-functions-in-tidyquant.html">Core Functions in tidyquant</a>
    <a class="dropdown-item" href="../articles/TQ02-quant-integrations-in-tidyquant.html">R Quantitative Analysis Package Integrations in tidyquant</a>
    <a class="dropdown-item" href="../articles/TQ03-scaling-and-modeling-with-tidyquant.html">Scaling and Modeling with tidyquant</a>
    <a class="dropdown-item" href="../articles/TQ04-charting-with-tidyquant.html">Charting with tidyquant</a>
    <a class="dropdown-item" href="../articles/TQ05-performance-analysis-with-tidyquant.html">Performance Analysis with tidyquant</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Excel Users</h6>
    <a class="dropdown-item" href="../articles/TQ06-excel-in-r.html">Excel in R with tidyquant</a>
  </div>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/business-science/tidyquant/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Aggregates a group of returns by asset into portfolio returns</h1>
      <small class="dont-index">Source: <a href="https://github.com/business-science/tidyquant/blob/HEAD/R/tq_portfolio.R" class="external-link"><code>R/tq_portfolio.R</code></a></small>
      <div class="d-none name"><code>tq_portfolio.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Aggregates a group of returns by asset into portfolio returns</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">tq_portfolio</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">assets_col</span>,</span>
<span>  <span class="va">returns_col</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  col_rename <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">tq_portfolio_</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">assets_col</span>,</span>
<span>  <span class="va">returns_col</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  col_rename <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">tq_repeat_df</span><span class="op">(</span><span class="va">data</span>, <span class="va">n</span>, index_col_name <span class="op">=</span> <span class="st">"portfolio"</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>A <code>tibble</code> (tidy data frame) of returns in tidy format (i.e long format).</p></dd>


<dt>assets_col</dt>
<dd><p>The column with assets (securities)</p></dd>


<dt>returns_col</dt>
<dd><p>The column with returns</p></dd>


<dt>weights</dt>
<dd><p>Optional parameter for the asset weights, which can be passed as a numeric vector the length of
the number of assets or a two column tibble with asset names in first column
and weights in second column.</p></dd>


<dt>col_rename</dt>
<dd><p>A string or character vector containing names that can be used
to quickly rename columns.</p></dd>


<dt>...</dt>
<dd><p>Additional parameters passed to <code><a href="https://rdrr.io/pkg/PerformanceAnalytics/man/Return.portfolio.html" class="external-link">PerformanceAnalytics::Return.portfolio</a></code></p></dd>


<dt>n</dt>
<dd><p>Number of times to repeat a data frame row-wise.</p></dd>


<dt>index_col_name</dt>
<dd><p>A renaming function for the "index" column, used when repeating data frames.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Returns data in the form of a <code>tibble</code> object.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>tq_portfolio</code> is a wrapper for <code><a href="https://rdrr.io/pkg/PerformanceAnalytics/man/Return.portfolio.html" class="external-link">PerformanceAnalytics::Return.portfolio</a></code>.
The main advantage is the results are returned as a <code>tibble</code> and the
function can be used with the <code>tidyverse</code>.</p>
<p><code>assets_col</code> and <code>returns_col</code> are columns within <code>data</code> that are used
to compute returns for a portfolio. The columns should be in "long" format (or "tidy" format)
meaning there is only one column containing all of the assets and one column containing
all of the return values (i.e. not in "wide" format with returns spread by asset).</p>
<p><code>weights</code> are the weights to be applied to the asset returns.
Weights can be input in one of three options:</p><ul><li><p>Single Portfolio: A numeric vector of weights that is the same length as unique number of assets.
The weights are applied in the order of the assets.</p></li>
<li><p>Single Portfolio: A two column tibble with assets in the first column and weights in the second column.
The advantage to this method is the weights are mapped to the assets and any unlisted
assets default to a weight of zero.</p></li>
<li><p>Multiple Portfolios: A three column tibble with portfolio index in the first
column, assets in the second column, and weights in the third column. The tibble
must be grouped by portfolio index.</p></li>
</ul><p><code>tq_repeat_df</code> is a simple function that repeats
a data frame <code>n</code> times row-wise (long-wise), and adds a new column for a portfolio index.
The function is used to assist in Multiple Portfolio analyses, and
is a useful precursor to <code>tq_portfolio</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index">
<ul><li><p><code><a href="tq_mutate.html">tq_transmute()</a></code> which can be used to get period returns.</p></li>
<li><p><code><a href="https://rdrr.io/pkg/PerformanceAnalytics/man/Return.portfolio.html" class="external-link">PerformanceAnalytics::Return.portfolio()</a></code> which is the underlying function
that specifies which parameters can be passed via <code>...</code></p></li>
</ul></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Load libraries</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use FANG data set</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get returns for individual stock components</span></span></span>
<span class="r-in"><span><span class="va">monthly_returns_stocks</span> <span class="op">&lt;-</span> <span class="va">FANG</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">symbol</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="tq_mutate.html">tq_transmute</a></span><span class="op">(</span><span class="va">adjusted</span>, <span class="va">periodReturn</span>, period <span class="op">=</span> <span class="st">"monthly"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##### Portfolio Aggregation Methods #####</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Method 1: Use tq_portfolio with numeric vector of weights</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.50</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">tq_portfolio</span><span class="op">(</span>data <span class="op">=</span> <span class="va">monthly_returns_stocks</span>,</span></span>
<span class="r-in"><span>             assets_col <span class="op">=</span> <span class="va">symbol</span>,</span></span>
<span class="r-in"><span>             returns_col <span class="op">=</span> <span class="va">monthly.returns</span>,</span></span>
<span class="r-in"><span>             weights <span class="op">=</span> <span class="va">weights</span>,</span></span>
<span class="r-in"><span>             col_rename <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>             wealth.index <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 48 × 2</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    date       portfolio.returns</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> 2013-01-31           0.260  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> 2013-02-28          -<span style="color: #BB0000;">0.004</span><span style="color: #BB0000; text-decoration: underline;">56</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> 2013-03-28          -<span style="color: #BB0000;">0.019</span><span style="color: #BB0000; text-decoration: underline;">5</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> 2013-04-30           0.081<span style="text-decoration: underline;">0</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> 2013-05-31          -<span style="color: #BB0000;">0.013</span><span style="color: #BB0000; text-decoration: underline;">9</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> 2013-06-28          -<span style="color: #BB0000;">0.017</span><span style="color: #BB0000; text-decoration: underline;">9</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> 2013-07-31           0.254  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> 2013-08-30           0.104  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> 2013-09-30           0.145  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> 2013-10-31           0.042<span style="text-decoration: underline;">0</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 38 more rows</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Method 2: Use tq_portfolio with two column tibble and map weights</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Note that GOOG's weighting is zero in Method 1. In Method 2,</span></span></span>
<span class="r-in"><span><span class="co"># GOOG is not added and same result is achieved.</span></span></span>
<span class="r-in"><span><span class="va">weights_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>symbol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"META"</span>, <span class="st">"AMZN"</span>, <span class="st">"NFLX"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.50</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">tq_portfolio</span><span class="op">(</span>data <span class="op">=</span> <span class="va">monthly_returns_stocks</span>,</span></span>
<span class="r-in"><span>             assets_col <span class="op">=</span> <span class="va">symbol</span>,</span></span>
<span class="r-in"><span>             returns_col <span class="op">=</span> <span class="va">monthly.returns</span>,</span></span>
<span class="r-in"><span>             weights <span class="op">=</span> <span class="va">weights_df</span>,</span></span>
<span class="r-in"><span>             col_rename <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>             wealth.index <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The assets in weights does not match the assets in data.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The weights for one or more periods do not sum up to 1: assuming a return of 0 for the residual weights</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 48 × 2</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    date       portfolio.returns</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> 2013-01-31           0.207  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> 2013-02-28           0.050<span style="text-decoration: underline;">4</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> 2013-03-28           0.004<span style="text-decoration: underline;">27</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> 2013-04-30           0.047<span style="text-decoration: underline;">5</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> 2013-05-31           0.032<span style="text-decoration: underline;">0</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> 2013-06-28          -<span style="color: #BB0000;">0.023</span><span style="color: #BB0000; text-decoration: underline;">9</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> 2013-07-31           0.084<span style="text-decoration: underline;">6</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> 2013-08-30           0.060<span style="text-decoration: underline;">0</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> 2013-09-30           0.064<span style="text-decoration: underline;">4</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> 2013-10-31           0.052<span style="text-decoration: underline;">3</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 38 more rows</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Method 3: Working with multiple portfolios</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 3A: Duplicate monthly_returns_stocks multiple times</span></span></span>
<span class="r-in"><span><span class="va">mult_monthly_returns_stocks</span> <span class="op">&lt;-</span> <span class="fu">tq_repeat_df</span><span class="op">(</span><span class="va">monthly_returns_stocks</span>, n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Ungrouping data frame groups: symbol</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 3B: Create weights table grouped by portfolio id</span></span></span>
<span class="r-in"><span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.50</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.00</span>,</span></span>
<span class="r-in"><span>             <span class="fl">0.00</span>, <span class="fl">0.50</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>,</span></span>
<span class="r-in"><span>             <span class="fl">0.25</span>, <span class="fl">0.00</span>, <span class="fl">0.50</span>, <span class="fl">0.25</span>,</span></span>
<span class="r-in"><span>             <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.00</span>, <span class="fl">0.50</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">stocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"META"</span>, <span class="st">"AMZN"</span>, <span class="st">"NFLX"</span>, <span class="st">"GOOG"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">weights_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="va">stocks</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu">tq_repeat_df</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">portfolio</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 3C: Scale to multiple portfolios</span></span></span>
<span class="r-in"><span><span class="fu">tq_portfolio</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mult_monthly_returns_stocks</span>,</span></span>
<span class="r-in"><span>             assets_col <span class="op">=</span> <span class="va">symbol</span>,</span></span>
<span class="r-in"><span>             returns_col <span class="op">=</span> <span class="va">monthly.returns</span>,</span></span>
<span class="r-in"><span>             weights <span class="op">=</span> <span class="va">weights_table</span>,</span></span>
<span class="r-in"><span>             col_rename <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>             wealth.index <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>There were 7 warnings in `dplyr::mutate()`.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> The first warning was:</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> In argument: `portfolio.. = purrr::pmap(list(returns.., weights..,</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>   portfolio), custom_function)`.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> In group 1: `portfolio = 1`.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Caused by warning in `check_weights()`:</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> The assets in weights does not match the assets in data.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Run `dplyr::last_dplyr_warnings()` to see the 6 remaining warnings.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 192 × 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># Groups:   portfolio [4]</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    portfolio date       portfolio.returns</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>         1 2013-01-31           0.207  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>         1 2013-02-28           0.050<span style="text-decoration: underline;">4</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>         1 2013-03-28           0.004<span style="text-decoration: underline;">27</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>         1 2013-04-30           0.047<span style="text-decoration: underline;">5</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>         1 2013-05-31           0.032<span style="text-decoration: underline;">0</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>         1 2013-06-28          -<span style="color: #BB0000;">0.023</span><span style="color: #BB0000; text-decoration: underline;">9</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>         1 2013-07-31           0.084<span style="text-decoration: underline;">6</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>         1 2013-08-30           0.060<span style="text-decoration: underline;">0</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>         1 2013-09-30           0.064<span style="text-decoration: underline;">4</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>         1 2013-10-31           0.052<span style="text-decoration: underline;">3</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 182 more rows</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Matt Dancho, Davis Vaughan.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

