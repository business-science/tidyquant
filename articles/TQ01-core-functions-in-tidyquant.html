<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Core Functions in tidyquant • tidyquant</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Core Functions in tidyquant">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-20GDZ5LL77"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-20GDZ5LL77');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidyquant</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.11.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/TQ00-introduction-to-tidyquant.html">Start</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><a class="dropdown-item" href="../articles/TQ00-introduction-to-tidyquant.html">Introduction to Tidyquant</a></li>
    <li><a class="dropdown-item" href="../articles/TQ01-core-functions-in-tidyquant.html">Core Functions in Tidyquant</a></li>
    <li><a class="dropdown-item" href="../articles/TQ02-quant-integrations-in-tidyquant.html">Quant Integrations in Tidyquant</a></li>
    <li><a class="dropdown-item" href="../articles/TQ03-scaling-and-modeling-with-tidyquant.html">Scaling and Modeling with Tidyquant</a></li>
    <li><a class="dropdown-item" href="../articles/TQ04-charting-with-tidyquant.html">Charting with Tidyquant</a></li>
    <li><a class="dropdown-item" href="../articles/TQ05-performance-analysis-with-tidyquant.html">Performance Analysis with Tidyquant</a></li>
    <li><a class="dropdown-item" href="../articles/TQ06-excel-in-r.html">Excel Integrations in R</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-api" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">API</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-api">
<li><a class="dropdown-item" href="../reference/index.html">API Functions</a></li>
    <li><a class="dropdown-item" href="../news/index.html">News</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/business-science/tidyquant"><span class="fa fab fa-github"></span></a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/business-science/tidyquant" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Core Functions in tidyquant</h1>
                        <h4 data-toc-skip class="author">Matt
Dancho</h4>
            
            <h4 data-toc-skip class="date">2025-05-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/business-science/tidyquant/blob/master/vignettes/TQ01-core-functions-in-tidyquant.Rmd" class="external-link"><code>vignettes/TQ01-core-functions-in-tidyquant.Rmd</code></a></small>
      <div class="d-none name"><code>TQ01-core-functions-in-tidyquant.Rmd</code></div>
    </div>

    
    
<blockquote>
<p>A few core functions with a lot of power</p>
</blockquote>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The <code>tidyquant</code> package has a <strong>few core functions
with a lot of power</strong>. Few functions means less of a learning
curve for the user, which is why there are only a handful of functions
the user needs to learn to perform the vast majority of financial
analysis tasks. The main functions are:</p>
<ul>
<li><p><strong>Get a Stock Index, <code><a href="../reference/tq_index.html">tq_index()</a></code>, or a Stock
Exchange, <code><a href="../reference/tq_index.html">tq_exchange()</a></code></strong>: Returns the stock symbols
and various attributes for every stock in an index or exchange. Eighteen
indexes and three exchanges are available.</p></li>
<li><p><strong>Get Quantitative Data, <code><a href="../reference/tq_get.html">tq_get()</a></code></strong>: A
one-stop shop to get data from various web-sources.</p></li>
<li><p><strong>Transmute, <code><a href="../reference/tq_mutate.html">tq_transmute()</a></code>, and Mutate,
<code><a href="../reference/tq_mutate.html">tq_mutate()</a></code>, Quantitative Data</strong>: Perform and scale
financial calculations completely within the <code>tidyverse</code>.
These workhorse functions integrate the <code>xts</code>,
<code>zoo</code>, <code>quantmod</code>, and <code>TTR</code>
packages.</p></li>
<li><p><strong>Performance analysis, <code><a href="../reference/tq_performance.html">tq_performance()</a></code>, and
portfolio aggregation, <code><a href="../reference/tq_portfolio.html">tq_portfolio()</a></code></strong>: The
<code>PerformanceAnalytics</code> integration enables analyzing
performance of assets and portfolios. Because of the breadth of this
topic, refer to <a href="TQ05-performance-analysis-with-tidyquant.html">Performance
Analysis with tidyquant</a> for a tutorial on these functions.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<p>Load the <code>tidyquant</code> package to get started.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Loads tidyquant, lubridate, xts, quantmod, TTR </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://business-science.github.io/tidyquant/">tidyquant</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="retrieve-consolidated-symbol-data">1.0 Retrieve Consolidated Symbol Data<a class="anchor" aria-label="anchor" href="#retrieve-consolidated-symbol-data"></a>
</h2>
<div class="section level3">
<h3 id="stock-indexes">1.1 Stock Indexes<a class="anchor" aria-label="anchor" href="#stock-indexes"></a>
</h3>
<p>A wide range of stock index / exchange lists can be retrieved using
<code><a href="../reference/tq_index.html">tq_index()</a></code>. To get a full list of the options, use
<code><a href="../reference/tq_index.html">tq_index_options()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tq_index.html">tq_index_options</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "DOW"       "DOWGLOBAL" "SP400"     "SP500"     "SP600"</span></span></code></pre>
<p>Set <code>x</code> as one of the options in the list of options above
to get the desired stock index / exchange.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tq_index.html">tq_index</a></span><span class="op">(</span><span class="st">"SP500"</span><span class="op">)</span></span></code></pre></div>
<p>The data source is State Street Global Advisors.</p>
</div>
<div class="section level3">
<h3 id="stock-exchanges">1.2 Stock Exchanges<a class="anchor" aria-label="anchor" href="#stock-exchanges"></a>
</h3>
<p>Stock lists for three stock exchanges are available: NASDAQ, NYSE,
and AMEX. If you forget, just use <code><a href="../reference/tq_index.html">tq_exchange_options()</a></code>. We
can easily get the full list of stocks on the NASDAQ exchange.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tq_index.html">tq_exchange</a></span><span class="op">(</span><span class="st">"NASDAQ"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="get-quantitative-data">1.0 Get Quantitative Data<a class="anchor" aria-label="anchor" href="#get-quantitative-data"></a>
</h2>
<p>The <code><a href="../reference/tq_get.html">tq_get()</a></code> function is used to collect data by
changing the <code>get</code> argument. The data sources:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Yahoo Finance</strong> - Daily stock data</li>
<li>
<strong>FRED</strong> - Economic data</li>
<li>
<strong>Quandl</strong> - Economic, Energy, &amp; Financial Data
API</li>
<li>
<strong>Tiingo</strong> - Financial API with sub-daily stock data
and crypto-currency</li>
<li>
<strong>Alpha Vantage</strong> - Financial API with sub-daily,
ForEx, and crypto-currency data</li>
<li>
<strong>Bloomberg</strong> - Financial API. Paid account is
required.</li>
</ol>
<p>Use <code><a href="../reference/tq_get.html">tq_get_options()</a></code> to see the full list.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tq_get.html">tq_get_options</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "stock.prices"       "stock.prices.japan" "dividends"         </span></span>
<span><span class="co">##  [4] "splits"             "economic.data"      "quandl"            </span></span>
<span><span class="co">##  [7] "quandl.datatable"   "tiingo"             "tiingo.iex"        </span></span>
<span><span class="co">## [10] "tiingo.crypto"      "alphavantager"      "alphavantage"      </span></span>
<span><span class="co">## [13] "rblpapi"</span></span></code></pre>
<div class="section level3">
<h3 id="yahoo-finance">2.1 Yahoo! Finance<a class="anchor" aria-label="anchor" href="#yahoo-finance"></a>
</h3>
<p>The stock prices can be retrieved succinctly using
<code>get = "stock.prices"</code>. This returns stock price data from
Yahoo Finance.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aapl_prices</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span><span class="st">"AAPL"</span>, get <span class="op">=</span> <span class="st">"stock.prices"</span>, from <span class="op">=</span> <span class="st">" 1990-01-01"</span><span class="op">)</span></span>
<span><span class="va">aapl_prices</span> </span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 8,898 × 8</span></span></span>
<span><span class="co">##    symbol date        open  high   low close    volume adjusted</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> AAPL   1990-01-02 0.315 0.335 0.312 0.333 183<span style="text-decoration: underline;">198</span>400    0.262</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> AAPL   1990-01-03 0.339 0.339 0.335 0.335 207<span style="text-decoration: underline;">995</span>200    0.264</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> AAPL   1990-01-04 0.342 0.346 0.333 0.336 221<span style="text-decoration: underline;">513</span>600    0.264</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> AAPL   1990-01-05 0.337 0.342 0.330 0.337 123<span style="text-decoration: underline;">312</span>000    0.265</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> AAPL   1990-01-08 0.335 0.339 0.330 0.339 101<span style="text-decoration: underline;">572</span>800    0.267</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> AAPL   1990-01-09 0.339 0.339 0.330 0.336  86<span style="text-decoration: underline;">139</span>200    0.264</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> AAPL   1990-01-10 0.336 0.336 0.319 0.321 199<span style="text-decoration: underline;">718</span>400    0.253</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> AAPL   1990-01-11 0.324 0.324 0.308 0.308 211<span style="text-decoration: underline;">052</span>800    0.243</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> AAPL   1990-01-12 0.306 0.310 0.301 0.308 171<span style="text-decoration: underline;">897</span>600    0.243</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> AAPL   1990-01-15 0.308 0.319 0.306 0.306 161<span style="text-decoration: underline;">739</span>200    0.241</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 8,888 more rows</span></span></span></code></pre>
<p>We can get multiple stocks:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AAPL"</span>, <span class="st">"META"</span>, <span class="st">"NFLX"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span>from <span class="op">=</span> <span class="st">"2013-01-01"</span>,</span>
<span>           to   <span class="op">=</span> <span class="st">"2017-01-01"</span><span class="op">)</span></span>
<span><span class="va">stocks</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3,024 × 8</span></span></span>
<span><span class="co">##    symbol date        open  high   low close    volume adjusted</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> AAPL   2013-01-02  19.8  19.8  19.3  19.6 560<span style="text-decoration: underline;">518</span>000     16.7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> AAPL   2013-01-03  19.6  19.6  19.3  19.4 352<span style="text-decoration: underline;">965</span>200     16.5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> AAPL   2013-01-04  19.2  19.2  18.8  18.8 594<span style="text-decoration: underline;">333</span>600     16.0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> AAPL   2013-01-07  18.6  18.9  18.4  18.7 484<span style="text-decoration: underline;">156</span>400     15.9</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> AAPL   2013-01-08  18.9  19.0  18.6  18.8 458<span style="text-decoration: underline;">707</span>200     15.9</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> AAPL   2013-01-09  18.7  18.8  18.4  18.5 407<span style="text-decoration: underline;">604</span>400     15.7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> AAPL   2013-01-10  18.9  18.9  18.4  18.7 601<span style="text-decoration: underline;">146</span>000     15.9</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> AAPL   2013-01-11  18.6  18.8  18.5  18.6 350<span style="text-decoration: underline;">506</span>800     15.8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> AAPL   2013-01-14  18.0  18.1  17.8  17.9 734<span style="text-decoration: underline;">207</span>600     15.2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> AAPL   2013-01-15  17.8  17.8  17.3  17.4 876<span style="text-decoration: underline;">772</span>400     14.8</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 3,014 more rows</span></span></span></code></pre>
<p>Yahoo Japan stock prices can be retrieved using a similar call,
<code>get = "stock.prices.japan"</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x8411T</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span><span class="st">"8411.T"</span>, get <span class="op">=</span> <span class="st">"stock.prices.japan"</span>, from <span class="op">=</span> <span class="st">"2016-01-01"</span>, to  <span class="op">=</span> <span class="st">"2016-12-31"</span><span class="op">)</span></span></code></pre></div>
<p>The data source is Yahoo Finance (<a href="https://finance.yahoo.com/" class="external-link uri">https://finance.yahoo.com/</a>) and Yahoo Finance Japan.</p>
</div>
<div class="section level3">
<h3 id="fred-economic-data">2.2 FRED Economic Data<a class="anchor" aria-label="anchor" href="#fred-economic-data"></a>
</h3>
<p>A wealth of economic data can be extracted from the Federal Reserve
Economic Data (FRED) database. The FRED contains over 10K data sets that
are free to use. See the <a href="https://fred.stlouisfed.org/categories" class="external-link">FRED categories</a> to
narrow down the data base and to get data codes. The <a href="https://fred.stlouisfed.org/series/DCOILWTICO" class="external-link">WTI Crude Oil
Prices</a> are shown below.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wti_price_usd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span><span class="st">"DCOILWTICO"</span>, get <span class="op">=</span> <span class="st">"economic.data"</span><span class="op">)</span></span>
<span><span class="va">wti_price_usd</span> </span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2,693 × 3</span></span></span>
<span><span class="co">##    symbol     date       price</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> DCOILWTICO 2015-01-01  <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> DCOILWTICO 2015-01-02  52.7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> DCOILWTICO 2015-01-05  50.0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> DCOILWTICO 2015-01-06  48.0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> DCOILWTICO 2015-01-07  48.7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> DCOILWTICO 2015-01-08  48.8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> DCOILWTICO 2015-01-09  48.4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> DCOILWTICO 2015-01-12  46.1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> DCOILWTICO 2015-01-13  45.9</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> DCOILWTICO 2015-01-14  48.5</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 2,683 more rows</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="nasdaq-data-link-quandl-api">2.3 Nasdaq Data Link (Quandl) API<a class="anchor" aria-label="anchor" href="#nasdaq-data-link-quandl-api"></a>
</h3>
<p><a href="https://data.nasdaq.com/" class="external-link">Quandl</a> provides access to a
vast number of financial and economic databases. The Quandl packages
must be installed separately.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"Quandl"</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="authentication">Authentication<a class="anchor" aria-label="anchor" href="#authentication"></a>
</h4>
<p>To make full use of the integration we recommend you set your api
key. To do this create or sign into your Quandl account and go to your
account api key page.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/quandl_api_key.html">quandl_api_key</a></span><span class="op">(</span><span class="st">"&lt;your-api-key&gt;"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="search">Search<a class="anchor" aria-label="anchor" href="#search"></a>
</h4>
<p>Searching Quandl from within the R console is possible with
<code><a href="../reference/quandl_search.html">quandl_search()</a></code>, a wrapper for
<code><a href="https://rdrr.io/pkg/Quandl/man/Quandl.search.html" class="external-link">Quandl::Quandl.search()</a></code>. An example search is shown below.
The only required argument is <code>query</code>. You can also visit the
<a href="https://data.nasdaq.com/search" class="external-link">Quandl Search</a> webpage to
search for available database codes.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/quandl_search.html">quandl_search</a></span><span class="op">(</span>query <span class="op">=</span> <span class="st">"Oil"</span>, database_code <span class="op">=</span> <span class="st">"NSE"</span>, per_page <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="getting-quandl-data">Getting Quandl Data<a class="anchor" aria-label="anchor" href="#getting-quandl-data"></a>
</h4>
<p>Getting data is integrated into <code><a href="../reference/tq_get.html">tq_get()</a></code>. Two get
options exist to retrieve Quandl data:</p>
<ol style="list-style-type: decimal">
<li>
<code>get = "quandl"</code>: Get’s Quandl time series data. A
wrapper for <code>Quandl()</code>.</li>
<li>
<code>get = "quandl.datatable"</code>: Gets Quandl datatables
(larger data sets that may not be time series). A wrapper for
<code>Quandl.datatable()</code>.</li>
</ol>
<p>Getting data from Quandl can be achieved in much the same way as the
other “get” options. Just pass the “codes” for the data along with
desired arguments for the underlying function.</p>
<p>The following uses <code>get = "quandl"</code> and the “WIKI”
database to download daily stock prices for AAPL in 2016. The output is
a tidy data frame.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WIKI/AAPL"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span>get  <span class="op">=</span> <span class="st">"quandl"</span>,</span>
<span>           from <span class="op">=</span> <span class="st">"2016-01-01"</span>,</span>
<span>           to   <span class="op">=</span> <span class="st">"2016-12-31"</span><span class="op">)</span></span></code></pre></div>
<p>The following time series options are available to be passed to the
underlying <code>Quandl()</code> function:</p>
<ul>
<li>
<code>start_date</code> (<code>from</code>) = “yyyy-mm-dd” |
<code>end_date</code> (<code>to</code>) = “yyyy-mm-dd”</li>
<li>
<code>column_index</code> = numeric column number (e.g. 1)</li>
<li>
<code>rows</code> = numeric row number indicating first n rows
(e.g. 100)</li>
<li>
<code>collapse</code> = “none”, “daily”, “weekly”, “monthly”,
“quarterly”, “annual”</li>
<li>
<code>transform</code> = “none”, “diff”, “rdiff”, “cumul”,
“normalize”</li>
</ul>
<p>Here’s an example to get period returns of the adj.close (column
index 11) using the <code>column_index</code>, <code>collapse</code> and
<code>transform</code> arguments.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="st">"WIKI/AAPL"</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span>get          <span class="op">=</span> <span class="st">"quandl"</span>,</span>
<span>           from         <span class="op">=</span> <span class="st">"2007-01-01"</span>,</span>
<span>           to           <span class="op">=</span> <span class="st">"2016-12-31"</span>,</span>
<span>           column_index <span class="op">=</span> <span class="fl">11</span>, </span>
<span>           collapse     <span class="op">=</span> <span class="st">"annual"</span>,      </span>
<span>           transform    <span class="op">=</span> <span class="st">"rdiff"</span><span class="op">)</span>       </span></code></pre></div>
<p>Datatables are larger data sets. These can be downloaded using
<code>get = "quandl.datatable"</code>. Note that the time series
arguments do not work with data tables.</p>
<p>Here’s several examples of <a href="https://data.nasdaq.com/databases/ZFB/documentation/about" class="external-link">Zacks
Fundamentals Collection B</a></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Zacks Fundamentals Collection B (DOW 30 Available to non subscribers)</span></span>
<span><span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span><span class="st">"ZACKS/FC"</span>, get <span class="op">=</span> <span class="st">"quandl.datatable"</span><span class="op">)</span>   <span class="co"># Zacks Fundamentals Condensed</span></span>
<span><span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span><span class="st">"ZACKS/FR"</span>, get <span class="op">=</span> <span class="st">"quandl.datatable"</span><span class="op">)</span>   <span class="co"># Zacks Fundamental Ratios</span></span>
<span><span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span><span class="st">"ZACKS/MT"</span>, get <span class="op">=</span> <span class="st">"quandl.datatable"</span><span class="op">)</span>   <span class="co"># Zacks Master Table</span></span>
<span><span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span><span class="st">"ZACKS/MKTV"</span>, get <span class="op">=</span> <span class="st">"quandl.datatable"</span><span class="op">)</span> <span class="co"># Zacks Market Value Supplement</span></span>
<span><span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span><span class="st">"ZACKS/SHRS"</span>, get <span class="op">=</span> <span class="st">"quandl.datatable"</span><span class="op">)</span> <span class="co"># Zacks Shares Out Supplement</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="tiingo-api">2.4 Tiingo API<a class="anchor" aria-label="anchor" href="#tiingo-api"></a>
</h3>
<p>The Tiingo API is a free source for stock prices, cryptocurrencies,
and intraday feeds from the IEX (Investors Exchange). This can serve as
an alternate source of data to Yahoo! Finance.</p>
<div class="section level4">
<h4 id="authentication-1">Authentication<a class="anchor" aria-label="anchor" href="#authentication-1"></a>
</h4>
<p>To make full use of the integration you need to get an API key and
then set your api key. If you don’t have one already, go to Tiingo
account and get your FREE API key. You can then set it as follows:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tiingo_api_key.html">tiingo_api_key</a></span><span class="op">(</span><span class="st">'&lt;your-api-key&gt;'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="getting-tiingo-data">Getting Tiingo Data<a class="anchor" aria-label="anchor" href="#getting-tiingo-data"></a>
</h4>
<p>The <code>tidyquant</code> package provides convenient wrappers to
the <code>riingo</code> package (R interface to Tiingo). Here’s how
<code><a href="../reference/tq_get.html">tq_get()</a></code> maps to <code>riingo</code>:</p>
<ul>
<li>Tiingo Prices:
<code>tq_get(get = "tiingo") = riingo::riingo_prices()</code>
</li>
<li>Tiingo IEX Data:
<code>tq_get(get = "tiingo.iex") = riingo::riingo_iex_prices()</code>
</li>
<li>Tiingo Crypto Data:
<code>tq_get(get = "tiingo.crypto") = riingo::riingo_crypto_prices()</code>
</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Tiingo Prices (Free alternative to Yahoo Finance!)</span></span>
<span><span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AAPL"</span>, <span class="st">"GOOG"</span><span class="op">)</span>, get <span class="op">=</span> <span class="st">"tiingo"</span>, from <span class="op">=</span> <span class="st">"2010-01-01"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Sub-daily prices from IEX ----</span></span>
<span><span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AAPL"</span>, <span class="st">"GOOG"</span><span class="op">)</span>,</span>
<span>       get <span class="op">=</span> <span class="st">"tiingo.iex"</span>,</span>
<span>       from   <span class="op">=</span> <span class="st">"2020-01-01"</span>,</span>
<span>       to     <span class="op">=</span> <span class="st">"2020-01-15"</span>,</span>
<span>       resample_frequency <span class="op">=</span> <span class="st">"5min"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Tiingo Bitcoin in USD ----</span></span>
<span><span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"btcusd"</span><span class="op">)</span>,</span>
<span>       get    <span class="op">=</span> <span class="st">"tiingo.crypto"</span>,</span>
<span>       from   <span class="op">=</span> <span class="st">"2020-01-01"</span>,</span>
<span>       to     <span class="op">=</span> <span class="st">"2020-01-15"</span>,</span>
<span>       resample_frequency <span class="op">=</span> <span class="st">"5min"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="alpha-vantage-api">2.5 Alpha Vantage API<a class="anchor" aria-label="anchor" href="#alpha-vantage-api"></a>
</h3>
<p><a href="https://www.alphavantage.co/" class="external-link">Alpha Vantage</a> provides
access to a real-time and historical financial data. The
<code>alphavantager</code> package, a lightweight R interface, has been
integrated into <code>tidyquant</code> as follows. The benefit of the
integration is the <strong>scalability since we can now get multiple
symbols returned in a tidy format</strong>. You will need to install it
first.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"alphavantager"</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="authentication-2">Authentication<a class="anchor" aria-label="anchor" href="#authentication-2"></a>
</h4>
<p>To make full use of the integration you need to get an API key and
then set your api key. If you don’t have one already, go to <a href="https://www.alphavantage.co/" class="external-link">Alpha Vantage</a> account and get
your FREE API key. You can then set it as follows:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("alphavantager")</span></span>
<span><span class="fu"><a href="../reference/av_api_key.html">av_api_key</a></span><span class="op">(</span><span class="st">"&lt;your-api-key&gt;"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="getting-alpha-vantage-data">Getting Alpha Vantage Data<a class="anchor" aria-label="anchor" href="#getting-alpha-vantage-data"></a>
</h4>
<p>Getting data is simple as the structure follows the <a href="https://www.alphavantage.co/documentation/" class="external-link">Alpha Vantage API
documentation</a>. For example, if you wish to retrieve intraday data at
5 minute intervals for META and MSFT, you can build the parameters
<code>x = c("META", "MSFT"), get = "alphavantager", av_fun = "TIME_SERIES_INTRADAY", interval = "5min"</code>.
The familiar <code>x</code> and <code>get</code> are the same as you
always use. The <code>av_fun</code> argument comes from
<code><a href="https://rdrr.io/pkg/alphavantager/man/av_get.html" class="external-link">alphavantager::av_get()</a></code> and the Alpha Vantage
documentation. The <code>interval</code> argument comes from the docs as
well.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Scaling is as simple as supplying multiple symbols</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"META"</span>, <span class="st">"MSFT"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span>get <span class="op">=</span> <span class="st">"alphavantage"</span>, av_fun <span class="op">=</span> <span class="st">"TIME_SERIES_INTRADAY"</span>, interval <span class="op">=</span> <span class="st">"5min"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="bloomberg">2.6 Bloomberg<a class="anchor" aria-label="anchor" href="#bloomberg"></a>
</h3>
<p><a href="https://www.bloomberg.com/professional/solution/bloomberg-terminal/" class="external-link">Bloomberg</a>
provides access to arguably the most comprehensive financial data and is
actively used by most major financial institutions that work with
financial data. The <code>Rblpapi</code> package, an R interface to
Bloomberg, has been integrated into <code>tidyquant</code> as follows.
The benefit of the integration is the <strong>scalability since we can
now get multiple symbols returned in a tidy format</strong>.</p>
<div class="section level4">
<h4 id="authentication-3">Authentication<a class="anchor" aria-label="anchor" href="#authentication-3"></a>
</h4>
<p>To make full use of the integration you need to have a Bloomberg
Terminal account (Note this is not a free service). If you have
Bloomberg Terminal running on your machine, you can connect as
follows:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("Rblpapi")</span></span>
<span><span class="fu">Rblpapi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rblpapi/man/blpConnect.html" class="external-link">blpConnect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="getting-bloomberg-data">Getting Bloomberg Data<a class="anchor" aria-label="anchor" href="#getting-bloomberg-data"></a>
</h4>
<p>Getting data is simple as the structure follows the <a href="https://CRAN.R-project.org/package=Rblpapi" class="external-link">Rblpapi API
documentation</a>. For example, if you wish to retrieve monthly data for
SPX Index and AGTHX Equity, you can build the <code>tq_get</code>
parameters as follows:</p>
<ul>
<li><code>x = c('SPX Index','ODMAX Equity')</code></li>
<li><code>get = "rblpapi"</code></li>
<li>
<code>rblpapi_fun = "bdh"</code> Note that “bdh” is the default, and
options include “bdh” (Bloomberg Data History), “bds” (Bloomberg Data
Set), and “bdp” (Bloomberg Data Point)</li>
<li>
<code>from / to</code> These get passed to <code>start.date</code>
and <code>end.date</code> and can be provided in “YYYY-MM-DD” character
format. Note that <code>start.date</code> and <code>end.date</code> from
<code>Rblpapi</code> can be used but must be converted to date or
datetime.</li>
<li>Other arguments: These are options that depend on the
<code>rblpapi_fun</code>. See <code>Rblpapi</code> documentation.</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get Bloomberg data in a tidy data frame</span></span>
<span><span class="va">my_bloomberg_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'SPX Index'</span>,<span class="st">'ODMAX Equity'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span>get         <span class="op">=</span> <span class="st">"Rblpapi"</span>,</span>
<span>           rblpapi_fun <span class="op">=</span> <span class="st">"bdh"</span>,</span>
<span>           fields      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PX_LAST"</span><span class="op">)</span>,</span>
<span>           options     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"periodicitySelection"</span> <span class="op">=</span> <span class="st">"WEEKLY"</span><span class="op">)</span>,</span>
<span>           from        <span class="op">=</span> <span class="st">"2016-01-01"</span>,</span>
<span>           to          <span class="op">=</span> <span class="st">"2016-12-31"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="mutate-quantitative-data">3.0 Mutate Quantitative Data<a class="anchor" aria-label="anchor" href="#mutate-quantitative-data"></a>
</h2>
<p>Mutating functions enable the <code>xts</code>/<code>zoo</code>,
<code>quantmod</code> and <code>TTR</code> functions to shine. We’ll
touch on the mutation functions briefly using the <code>FANG</code> data
set, which consists of daily prices for META, AMZN, GOOG, and NFLX from
the beginning of 2013 to the end of 2016. We’ll apply the functions to
grouped data sets to get a feel for how each works</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">FANG</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4,032 × 8</span></span></span>
<span><span class="co">##    symbol date        open  high   low close    volume adjusted</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> META   2013-01-02  27.4  28.2  27.4  28    69<span style="text-decoration: underline;">846</span>400     28  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> META   2013-01-03  27.9  28.5  27.6  27.8  63<span style="text-decoration: underline;">140</span>600     27.8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> META   2013-01-04  28.0  28.9  27.8  28.8  72<span style="text-decoration: underline;">715</span>400     28.8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> META   2013-01-07  28.7  29.8  28.6  29.4  83<span style="text-decoration: underline;">781</span>800     29.4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> META   2013-01-08  29.5  29.6  28.9  29.1  45<span style="text-decoration: underline;">871</span>300     29.1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> META   2013-01-09  29.7  30.6  29.5  30.6 104<span style="text-decoration: underline;">787</span>700     30.6</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> META   2013-01-10  30.6  31.5  30.3  31.3  95<span style="text-decoration: underline;">316</span>400     31.3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> META   2013-01-11  31.3  32.0  31.1  31.7  89<span style="text-decoration: underline;">598</span>000     31.7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> META   2013-01-14  32.1  32.2  30.6  31.0  98<span style="text-decoration: underline;">892</span>800     31.0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> META   2013-01-15  30.6  31.7  29.9  30.1 173<span style="text-decoration: underline;">242</span>600     30.1</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 4,022 more rows</span></span></span></code></pre>
<p>For a detailed walkthrough of the compatible functions, see the next
vignette in the series, <a href="TQ02-quant-integrations-in-tidyquant.html">R Quantitative Analysis
Package Integrations in tidyquant</a>.</p>
<div class="section level3">
<h3 id="transmute-quantitative-data-tq_transmute">3.1 Transmute Quantitative Data, tq_transmute<a class="anchor" aria-label="anchor" href="#transmute-quantitative-data-tq_transmute"></a>
</h3>
<p>Transmute the results of <code><a href="../reference/tq_get.html">tq_get()</a></code>. Transmute here holds
almost the same meaning as in <code>dplyr</code>, only the newly created
columns will be returned, but with <code><a href="../reference/tq_mutate.html">tq_transmute()</a></code>, the
number of rows returned can be different than the original data frame.
This is important for changing periodicity. An example is periodicity
aggregation from daily to monthly.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">FANG</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">symbol</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_mutate.html">tq_transmute</a></span><span class="op">(</span>select <span class="op">=</span> <span class="va">adjusted</span>, mutate_fun <span class="op">=</span> <span class="va">to.monthly</span>, indexAt <span class="op">=</span> <span class="st">"lastof"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 192 × 3</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   symbol [4]</span></span></span>
<span><span class="co">##    symbol date       adjusted</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> META   2013-01-31     31.0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> META   2013-02-28     27.2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> META   2013-03-31     25.6</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> META   2013-04-30     27.8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> META   2013-05-31     24.4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> META   2013-06-30     24.9</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> META   2013-07-31     36.8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> META   2013-08-31     41.3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> META   2013-09-30     50.2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> META   2013-10-31     50.2</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 182 more rows</span></span></span></code></pre>
<p>Let’s go through what happened. <code>select</code> allows you to
easily choose what columns get passed to <code>mutate_fun</code>. In
example above, <code>adjusted</code> selects the “adjusted” column from
<code>data</code>, and sends it to the mutate function,
<code>to.monthly</code>, which mutates the periodicity from daily to
monthly. Additional arguments can be passed to the
<code>mutate_fun</code> by way of <code>...</code>. We are passing the
<code>indexAt</code> argument to return a date that matches the first
date in the period.</p>
<div class="section level4">
<h4 id="working-with-non-ohlc-data">Working with non-OHLC data<a class="anchor" aria-label="anchor" href="#working-with-non-ohlc-data"></a>
</h4>
<p>Returns from FRED, Oanda, and other sources do not have open, high,
low, close (OHLC) format. However, this is not a problem with
<code>select</code>. The following example shows how to transmute WTI
Crude daily prices to monthly prices. Since we only have a single column
to pass, we can leave the <code>select</code> argument as
<code>NULL</code> which selects all columns by default. This sends the
price column to the <code>to.period</code> mutate function.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wti_prices</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span><span class="st">"DCOILWTICO"</span>, get <span class="op">=</span> <span class="st">"economic.data"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">wti_prices</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>    </span>
<span>    <span class="fu"><a href="../reference/tq_mutate.html">tq_transmute</a></span><span class="op">(</span>mutate_fun <span class="op">=</span> <span class="va">to.period</span>,</span>
<span>                 period     <span class="op">=</span> <span class="st">"months"</span>, </span>
<span>                 col_rename <span class="op">=</span> <span class="st">"WTI Price"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 124 × 2</span></span></span>
<span><span class="co">##    date       `WTI Price`</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 2015-01-30        47.8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 2015-02-27        49.8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 2015-03-31        47.7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 2015-04-30        59.6</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 2015-05-29        60.2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 2015-06-30        59.5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 2015-07-31        47.1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 2015-08-31        49.2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 2015-09-30        45.1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 2015-10-30        46.6</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 114 more rows</span></span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="mutate-quantitative-data-tq_mutate">3.2 Mutate Quantitative Data, tq_mutate<a class="anchor" aria-label="anchor" href="#mutate-quantitative-data-tq_mutate"></a>
</h3>
<p>Adds a column or set of columns to the tibble with the calculated
attributes (hence the original tibble is returned, mutated with the
additional columns). An example is getting the <code>MACD</code> from
<code>close</code>, which mutates the original input by adding MACD and
Signal columns. Note that we can quickly rename the columns using the
<code>col_rename</code> argument.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">FANG</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">symbol</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_mutate.html">tq_mutate</a></span><span class="op">(</span>select     <span class="op">=</span> <span class="va">close</span>, </span>
<span>              mutate_fun <span class="op">=</span> <span class="va">MACD</span>, </span>
<span>              col_rename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MACD"</span>, <span class="st">"Signal"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4,032 × 10</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   symbol [4]</span></span></span>
<span><span class="co">##    symbol date        open  high   low close    volume adjusted  MACD Signal</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> META   2013-01-02  27.4  28.2  27.4  28    69<span style="text-decoration: underline;">846</span>400     28      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> META   2013-01-03  27.9  28.5  27.6  27.8  63<span style="text-decoration: underline;">140</span>600     27.8    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> META   2013-01-04  28.0  28.9  27.8  28.8  72<span style="text-decoration: underline;">715</span>400     28.8    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> META   2013-01-07  28.7  29.8  28.6  29.4  83<span style="text-decoration: underline;">781</span>800     29.4    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> META   2013-01-08  29.5  29.6  28.9  29.1  45<span style="text-decoration: underline;">871</span>300     29.1    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> META   2013-01-09  29.7  30.6  29.5  30.6 104<span style="text-decoration: underline;">787</span>700     30.6    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> META   2013-01-10  30.6  31.5  30.3  31.3  95<span style="text-decoration: underline;">316</span>400     31.3    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> META   2013-01-11  31.3  32.0  31.1  31.7  89<span style="text-decoration: underline;">598</span>000     31.7    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> META   2013-01-14  32.1  32.2  30.6  31.0  98<span style="text-decoration: underline;">892</span>800     31.0    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> META   2013-01-15  30.6  31.7  29.9  30.1 173<span style="text-decoration: underline;">242</span>600     30.1    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 4,022 more rows</span></span></span></code></pre>
<p>Note that a mutation can occur if, and only if, the mutation has the
same structure of the original tibble. In other words, the calculation
must have the same number of rows and row.names (or date fields),
otherwise the mutation cannot be performed.</p>
<div class="section level4">
<h4 id="mutate-rolling-regressions-with-rollapply">Mutate rolling regressions with rollapply<a class="anchor" aria-label="anchor" href="#mutate-rolling-regressions-with-rollapply"></a>
</h4>
<p>A very powerful example is applying <strong>custom functions</strong>
across a rolling window using <code>rollapply</code>. A specific example
is using the <code>rollapply</code> function to compute a rolling
regression. This example is slightly more complicated so it will be
broken down into three steps:</p>
<ol style="list-style-type: decimal">
<li>Get returns</li>
<li>Create a custom function</li>
<li>Apply the custom function across a rolling window using
<code>tq_mutate(mutate_fun = rollapply)</code>
</li>
</ol>
<p><em>Step 1: Get Returns</em></p>
<p>First, get combined returns. The asset and baseline returns should be
in wide format, which is needed for the <code>lm</code> function in the
next step.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fb_returns</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span><span class="st">"META"</span>, get  <span class="op">=</span> <span class="st">"stock.prices"</span>, from <span class="op">=</span> <span class="st">"2016-01-01"</span>, to   <span class="op">=</span> <span class="st">"2016-12-31"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_mutate.html">tq_transmute</a></span><span class="op">(</span><span class="va">adjusted</span>, <span class="va">periodReturn</span>, period <span class="op">=</span> <span class="st">"weekly"</span>, col_rename <span class="op">=</span> <span class="st">"fb.returns"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xlk_returns</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span><span class="st">"XLK"</span>, from <span class="op">=</span> <span class="st">"2016-01-01"</span>, to <span class="op">=</span> <span class="st">"2016-12-31"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_mutate.html">tq_transmute</a></span><span class="op">(</span><span class="va">adjusted</span>, <span class="va">periodReturn</span>, period <span class="op">=</span> <span class="st">"weekly"</span>, col_rename <span class="op">=</span> <span class="st">"xlk.returns"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">returns_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">fb_returns</span>, <span class="va">xlk_returns</span>, by <span class="op">=</span> <span class="st">"date"</span><span class="op">)</span></span>
<span><span class="va">returns_combined</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 52 × 3</span></span></span>
<span><span class="co">##    date       fb.returns xlk.returns</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 2016-01-08   -<span style="color: #BB0000;">0.047</span><span style="color: #BB0000; text-decoration: underline;">8</span>     -<span style="color: #BB0000;">0.051</span><span style="color: #BB0000; text-decoration: underline;">6</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 2016-01-15   -<span style="color: #BB0000;">0.024</span><span style="color: #BB0000; text-decoration: underline;">2</span>     -<span style="color: #BB0000;">0.018</span><span style="color: #BB0000; text-decoration: underline;">7</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 2016-01-22    0.031<span style="text-decoration: underline;">3</span>      0.026<span style="text-decoration: underline;">4</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 2016-01-29    0.146       0.021<span style="text-decoration: underline;">3</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 2016-02-05   -<span style="color: #BB0000;">0.072</span><span style="color: #BB0000; text-decoration: underline;">5</span>     -<span style="color: #BB0000;">0.042</span><span style="color: #BB0000; text-decoration: underline;">2</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 2016-02-12   -<span style="color: #BB0000;">0.019</span><span style="color: #BB0000; text-decoration: underline;">8</span>     -<span style="color: #BB0000;">0.005</span><span style="color: #BB0000; text-decoration: underline;">82</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 2016-02-19    0.025<span style="text-decoration: underline;">1</span>      0.035<span style="text-decoration: underline;">4</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 2016-02-26    0.032<span style="text-decoration: underline;">0</span>      0.014<span style="text-decoration: underline;">8</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 2016-03-04    0.004<span style="text-decoration: underline;">36</span>     0.028<span style="text-decoration: underline;">1</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 2016-03-11    0.009<span style="text-decoration: underline;">41</span>     0.010<span style="text-decoration: underline;">6</span> </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 42 more rows</span></span></span></code></pre>
<p><em>Step 2: Create a custom function</em></p>
<p>Next, create a custom regression function, which will be used to
apply over the rolling window in Step 3. An important point is that the
“data” will be passed to the regression function as an <code>xts</code>
object. The <code><a href="https://rdrr.io/pkg/timetk/man/tk_tbl.html" class="external-link">timetk::tk_tbl</a></code> function takes care of
converting to a data frame for the <code>lm</code> function to work
properly with the columns “fb.returns” and “xlk.returns”.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regr_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">fb.returns</span> <span class="op">~</span> <span class="va">xlk.returns</span>, data <span class="op">=</span> <span class="fu">timetk</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/timetk/man/tk_tbl.html" class="external-link">tk_tbl</a></span><span class="op">(</span><span class="va">data</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><em>Step 3: Apply the custom function</em></p>
<p>Now we can use <code><a href="../reference/tq_mutate.html">tq_mutate()</a></code> to apply the custom
regression function over a rolling window using <code>rollapply</code>
from the <code>zoo</code> package. Internally, since we left
<code>select = NULL</code>, the <code>returns_combined</code> data frame
is being passed automatically to the <code>data</code> argument of the
<code>rollapply</code> function. All you need to specify is the
<code>mutate_fun = rollapply</code> and any additional arguments
necessary to apply the <code>rollapply</code> function. We’ll specify a
12 week window via <code>width = 12</code>. The <code>FUN</code>
argument is our custom regression function, <code>regr_fun</code>. It’s
extremely important to specify <code>by.column = FALSE</code>, which
tells <code>rollapply</code> to perform the computation using the data
as a whole rather than apply the function to each column independently.
The <code>col_rename</code> argument is used to rename the added
columns.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">returns_combined</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_mutate.html">tq_mutate</a></span><span class="op">(</span>mutate_fun <span class="op">=</span> <span class="va">rollapply</span>,</span>
<span>              width      <span class="op">=</span> <span class="fl">12</span>,</span>
<span>              FUN        <span class="op">=</span> <span class="va">regr_fun</span>,</span>
<span>              by.column  <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>              col_rename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"coef.0"</span>, <span class="st">"coef.1"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 52 × 5</span></span></span>
<span><span class="co">##    date       fb.returns xlk.returns coef.0 coef.1</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 2016-01-08   -<span style="color: #BB0000;">0.047</span><span style="color: #BB0000; text-decoration: underline;">8</span>     -<span style="color: #BB0000;">0.051</span><span style="color: #BB0000; text-decoration: underline;">6</span>      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 2016-01-15   -<span style="color: #BB0000;">0.024</span><span style="color: #BB0000; text-decoration: underline;">2</span>     -<span style="color: #BB0000;">0.018</span><span style="color: #BB0000; text-decoration: underline;">7</span>      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 2016-01-22    0.031<span style="text-decoration: underline;">3</span>      0.026<span style="text-decoration: underline;">4</span>      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 2016-01-29    0.146       0.021<span style="text-decoration: underline;">3</span>      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 2016-02-05   -<span style="color: #BB0000;">0.072</span><span style="color: #BB0000; text-decoration: underline;">5</span>     -<span style="color: #BB0000;">0.042</span><span style="color: #BB0000; text-decoration: underline;">2</span>      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 2016-02-12   -<span style="color: #BB0000;">0.019</span><span style="color: #BB0000; text-decoration: underline;">8</span>     -<span style="color: #BB0000;">0.005</span><span style="color: #BB0000; text-decoration: underline;">82</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 2016-02-19    0.025<span style="text-decoration: underline;">1</span>      0.035<span style="text-decoration: underline;">4</span>      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 2016-02-26    0.032<span style="text-decoration: underline;">0</span>      0.014<span style="text-decoration: underline;">8</span>      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 2016-03-04    0.004<span style="text-decoration: underline;">36</span>     0.028<span style="text-decoration: underline;">1</span>      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 2016-03-11    0.009<span style="text-decoration: underline;">41</span>     0.010<span style="text-decoration: underline;">6</span>      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 42 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">returns_combined</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 52 × 3</span></span></span>
<span><span class="co">##    date       fb.returns xlk.returns</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 2016-01-08   -<span style="color: #BB0000;">0.047</span><span style="color: #BB0000; text-decoration: underline;">8</span>     -<span style="color: #BB0000;">0.051</span><span style="color: #BB0000; text-decoration: underline;">6</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 2016-01-15   -<span style="color: #BB0000;">0.024</span><span style="color: #BB0000; text-decoration: underline;">2</span>     -<span style="color: #BB0000;">0.018</span><span style="color: #BB0000; text-decoration: underline;">7</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 2016-01-22    0.031<span style="text-decoration: underline;">3</span>      0.026<span style="text-decoration: underline;">4</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 2016-01-29    0.146       0.021<span style="text-decoration: underline;">3</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 2016-02-05   -<span style="color: #BB0000;">0.072</span><span style="color: #BB0000; text-decoration: underline;">5</span>     -<span style="color: #BB0000;">0.042</span><span style="color: #BB0000; text-decoration: underline;">2</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 2016-02-12   -<span style="color: #BB0000;">0.019</span><span style="color: #BB0000; text-decoration: underline;">8</span>     -<span style="color: #BB0000;">0.005</span><span style="color: #BB0000; text-decoration: underline;">82</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 2016-02-19    0.025<span style="text-decoration: underline;">1</span>      0.035<span style="text-decoration: underline;">4</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 2016-02-26    0.032<span style="text-decoration: underline;">0</span>      0.014<span style="text-decoration: underline;">8</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 2016-03-04    0.004<span style="text-decoration: underline;">36</span>     0.028<span style="text-decoration: underline;">1</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 2016-03-11    0.009<span style="text-decoration: underline;">41</span>     0.010<span style="text-decoration: underline;">6</span> </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 42 more rows</span></span></span></code></pre>
<p>As shown above, the rolling regression coefficients were added to the
data frame.</p>
</div>
</div>
<div class="section level3">
<h3 id="xy-variants-tq_mutate_xy-and-tq_transmute_xy">3.3 _xy Variants, tq_mutate_xy and tq_transmute_xy<a class="anchor" aria-label="anchor" href="#xy-variants-tq_mutate_xy-and-tq_transmute_xy"></a>
</h3>
<p>Enables working with mutation functions that require two primary
inputs (e.g. EVWMA, VWAP, etc).</p>
<div class="section level4">
<h4 id="mutate-with-two-primary-inputs">Mutate with two primary inputs<a class="anchor" aria-label="anchor" href="#mutate-with-two-primary-inputs"></a>
</h4>
<p>EVWMA (exponential volume-weighted moving average) requires two
inputs, price and volume. To work with these columns, we can switch to
the xy variants, <code><a href="../reference/tq_mutate.html">tq_transmute_xy()</a></code> and
<code><a href="../reference/tq_mutate.html">tq_mutate_xy()</a></code>. The only difference is instead of the
<code>select</code> argument, you use <code>x</code> and <code>y</code>
arguments to pass the columns needed based on the
<code>mutate_fun</code> documentation.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">FANG</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">symbol</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_mutate.html">tq_mutate_xy</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">close</span>, y <span class="op">=</span> <span class="va">volume</span>, </span>
<span>                 mutate_fun <span class="op">=</span> <span class="va">EVWMA</span>, col_rename <span class="op">=</span> <span class="st">"EVWMA"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4,032 × 9</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   symbol [4]</span></span></span>
<span><span class="co">##    symbol date        open  high   low close    volume adjusted EVWMA</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> META   2013-01-02  27.4  28.2  27.4  28    69<span style="text-decoration: underline;">846</span>400     28    <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> META   2013-01-03  27.9  28.5  27.6  27.8  63<span style="text-decoration: underline;">140</span>600     27.8  <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> META   2013-01-04  28.0  28.9  27.8  28.8  72<span style="text-decoration: underline;">715</span>400     28.8  <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> META   2013-01-07  28.7  29.8  28.6  29.4  83<span style="text-decoration: underline;">781</span>800     29.4  <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> META   2013-01-08  29.5  29.6  28.9  29.1  45<span style="text-decoration: underline;">871</span>300     29.1  <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> META   2013-01-09  29.7  30.6  29.5  30.6 104<span style="text-decoration: underline;">787</span>700     30.6  <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> META   2013-01-10  30.6  31.5  30.3  31.3  95<span style="text-decoration: underline;">316</span>400     31.3  <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> META   2013-01-11  31.3  32.0  31.1  31.7  89<span style="text-decoration: underline;">598</span>000     31.7  <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> META   2013-01-14  32.1  32.2  30.6  31.0  98<span style="text-decoration: underline;">892</span>800     31.0  <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> META   2013-01-15  30.6  31.7  29.9  30.1 173<span style="text-decoration: underline;">242</span>600     30.1  30.1</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 4,022 more rows</span></span></span></code></pre>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matt Dancho, Davis Vaughan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
