<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="tidyquant">
<title>Performance Analysis with tidyquant • tidyquant</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Performance Analysis with tidyquant">
<meta property="og:description" content="tidyquant">
<meta property="og:image" content="https://business-science.github.io/tidyquant/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-76139189-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-76139189-2');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tidyquant</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.7.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/TQ00-introduction-to-tidyquant.html">Start</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Financial Workflow</h6>
    <a class="dropdown-item" href="../articles/TQ00-introduction-to-tidyquant.html">Introduction to tidyquant</a>
    <a class="dropdown-item" href="../articles/TQ01-core-functions-in-tidyquant.html">Core Functions in tidyquant</a>
    <a class="dropdown-item" href="../articles/TQ02-quant-integrations-in-tidyquant.html">R Quantitative Analysis Package Integrations in tidyquant</a>
    <a class="dropdown-item" href="../articles/TQ03-scaling-and-modeling-with-tidyquant.html">Scaling and Modeling with tidyquant</a>
    <a class="dropdown-item" href="../articles/TQ04-charting-with-tidyquant.html">Charting with tidyquant</a>
    <a class="dropdown-item" href="../articles/TQ05-performance-analysis-with-tidyquant.html">Performance Analysis with tidyquant</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Excel Users</h6>
    <a class="dropdown-item" href="../articles/TQ06-excel-in-r.html">Excel in R with tidyquant</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/business-science/tidyquant/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Performance Analysis with tidyquant</h1>
                        <h4 data-toc-skip class="author">Matt
Dancho</h4>
            
            <h4 data-toc-skip class="date">2024-06-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/business-science/tidyquant/blob/HEAD/vignettes/TQ05-performance-analysis-with-tidyquant.Rmd" class="external-link"><code>vignettes/TQ05-performance-analysis-with-tidyquant.Rmd</code></a></small>
      <div class="d-none name"><code>TQ05-performance-analysis-with-tidyquant.Rmd</code></div>
    </div>

    
    
<blockquote>
<p>Tidy analysis of stock and portfolio return performance with
<code>PerformanceAnalytics</code></p>
</blockquote>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Financial asset (individual stocks, securities, etc) and portfolio
(groups of stocks, securities, etc) performance analysis is a deep field
with a wide range of theories and methods for analyzing risk versus
reward. The <code>PerformanceAnalytics</code> package consolidates
functions to compute many of the most widely used performance metrics.
<code>tidyquant</code> integrates this functionality so it can be used
at scale using the split, apply, combine framework within the
<code>tidyverse</code>. Two primary functions integrate the performance
analysis functionality:</p>
<ul>
<li>
<code>tq_performance</code> implements the performance analysis
functions in a tidy way, enabling scaling analysis using the split,
apply, combine framework.</li>
<li>
<code>tq_portfolio</code> provides a useful tool set for aggregating
a group of individual asset returns into one or many portfolios.</li>
</ul>
<p>This vignette aims to cover three aspects of performance
analysis:</p>
<ol style="list-style-type: decimal">
<li><p>The general workflow to go from start to finish on both an asset
and a portfolio level</p></li>
<li><p>Some of the available techniques to implement once the workflow
is implemented</p></li>
<li><p>How to customize <code>tq_portfolio</code> and
<code>tq_performance</code> using the <code>...</code>
parameter</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="key-concepts">1.0 Key Concepts<a class="anchor" aria-label="anchor" href="#key-concepts"></a>
</h2>
<p>An important concept is that performance analysis is based on the
statistical properties of <strong>returns</strong> (not prices). As a
result, this package uses inputs of <strong>time-based returns as
opposed to stock prices</strong>. The arguments change to
<code>Ra</code> for the asset returns and <code>Rb</code> for the
baseline returns. We’ll go over how to get returns in the <a href="#workflow">Workflow</a> section.</p>
<p>Another important concept is the <strong>baseline</strong>. The
baseline is what you are measuring performance against. A baseline can
be anything, but in many cases it’s a representative average of how an
investment might perform with little or no effort. Often indexes such as
the S&amp;P500 are used for general market performance. Other times more
specific Exchange Traded Funds (ETFs) are used such as the SPDR
Technology ETF (XLK). The important concept here is that you measure the
asset performance (<code>Ra</code>) against the baseline
(<code>Rb</code>).</p>
<p>Now for a quick tutorial to show off the
<code>PerformanceAnalytics</code> package integration.</p>
</div>
<div class="section level2">
<h2 id="quick-example">2.0 Quick Example<a class="anchor" aria-label="anchor" href="#quick-example"></a>
</h2>
<p>One of the most widely used risk to return metrics is the <a href="https://www.investopedia.com/terms/c/capm.asp" class="external-link">Capital Asset
Pricing Model (CAPM)</a>. According to Investopedia:</p>
<blockquote>
<p>The capital asset pricing model (CAPM) is a model that describes the
relationship between systematic risk and expected return for assets,
particularly stocks. CAPM is widely used throughout finance for the
pricing of risky securities, generating expected returns for assets
given the risk of those assets and calculating costs of capital.</p>
</blockquote>
<p>We’ll use the <code>PerformanceAnalytics</code> function,
<code>table.CAPM</code>, to evaluate the returns of several technology
stocks against the SPDR Technology ETF (XLK).</p>
<p>First, load the <code>tidyquant</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://business-science.github.io/tidyquant/">tidyquant</a></span><span class="op">)</span></span></code></pre></div>
<p>Second, get the stock returns for the stocks we wish to evaluate. We
use <code>tq_get</code> to get stock prices from Yahoo Finance,
<code>group_by</code> to group the stock prices related to each symbol,
and <code>tq_transmute</code> to retrieve period returns in a monthly
periodicity using the “adjusted” stock prices (adjusted for stock
splits, which can throw off returns, affecting the performance
analysis). Review the output and see that there are three groups of
symbols indicating the data has been grouped appropriately.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Ra</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AAPL"</span>, <span class="st">"GOOG"</span>, <span class="st">"NFLX"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span>get  <span class="op">=</span> <span class="st">"stock.prices"</span>,</span>
<span>           from <span class="op">=</span> <span class="st">"2010-01-01"</span>,</span>
<span>           to   <span class="op">=</span> <span class="st">"2015-12-31"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">symbol</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_mutate.html">tq_transmute</a></span><span class="op">(</span>select     <span class="op">=</span> <span class="va">adjusted</span>, </span>
<span>                 mutate_fun <span class="op">=</span> <span class="va">periodReturn</span>, </span>
<span>                 period     <span class="op">=</span> <span class="st">"monthly"</span>, </span>
<span>                 col_rename <span class="op">=</span> <span class="st">"Ra"</span><span class="op">)</span></span>
<span><span class="va">Ra</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 216 × 3</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   symbol [3]</span></span></span>
<span><span class="co">##    symbol date            Ra</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> AAPL   2010-01-29 -<span style="color: #BB0000;">0.103</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> AAPL   2010-02-26  0.065<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> AAPL   2010-03-31  0.148 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> AAPL   2010-04-30  0.111 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> AAPL   2010-05-28 -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> AAPL   2010-06-30 -<span style="color: #BB0000;">0.020</span><span style="color: #BB0000; text-decoration: underline;">8</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> AAPL   2010-07-30  0.022<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> AAPL   2010-08-31 -<span style="color: #BB0000;">0.055</span><span style="color: #BB0000; text-decoration: underline;">0</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> AAPL   2010-09-30  0.167 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> AAPL   2010-10-29  0.060<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 206 more rows</span></span></span></code></pre>
<p>Next, we get the baseline prices. We’ll use the XLK. Note that there
is no need to group because we are just getting one data set.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Rb</span> <span class="op">&lt;-</span> <span class="st">"XLK"</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span>get  <span class="op">=</span> <span class="st">"stock.prices"</span>,</span>
<span>           from <span class="op">=</span> <span class="st">"2010-01-01"</span>,</span>
<span>           to   <span class="op">=</span> <span class="st">"2015-12-31"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_mutate.html">tq_transmute</a></span><span class="op">(</span>select     <span class="op">=</span> <span class="va">adjusted</span>, </span>
<span>                 mutate_fun <span class="op">=</span> <span class="va">periodReturn</span>, </span>
<span>                 period     <span class="op">=</span> <span class="st">"monthly"</span>, </span>
<span>                 col_rename <span class="op">=</span> <span class="st">"Rb"</span><span class="op">)</span></span>
<span><span class="va">Rb</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 72 × 2</span></span></span>
<span><span class="co">##    date            Rb</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 2010-01-29 -<span style="color: #BB0000;">0.099</span><span style="color: #BB0000; text-decoration: underline;">3</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 2010-02-26  0.034<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 2010-03-31  0.068<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 2010-04-30  0.012<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 2010-05-28 -<span style="color: #BB0000;">0.074</span><span style="color: #BB0000; text-decoration: underline;">8</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 2010-06-30 -<span style="color: #BB0000;">0.054</span><span style="color: #BB0000; text-decoration: underline;">0</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 2010-07-30  0.074<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 2010-08-31 -<span style="color: #BB0000;">0.056</span><span style="color: #BB0000; text-decoration: underline;">1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 2010-09-30  0.117 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 2010-10-29  0.057<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 62 more rows</span></span></span></code></pre>
<p>Now, we combine the two data sets using the “date” field using
<code>left_join</code> from the <code>dplyr</code> package. Review the
results and see that we still have three groups of returns, and columns
“Ra” and “Rb” are side-by-side.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RaRb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">Ra</span>, <span class="va">Rb</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date"</span> <span class="op">=</span> <span class="st">"date"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">RaRb</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 216 × 4</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   symbol [3]</span></span></span>
<span><span class="co">##    symbol date            Ra      Rb</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> AAPL   2010-01-29 -<span style="color: #BB0000;">0.103</span>  -<span style="color: #BB0000;">0.099</span><span style="color: #BB0000; text-decoration: underline;">3</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> AAPL   2010-02-26  0.065<span style="text-decoration: underline;">4</span>  0.034<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> AAPL   2010-03-31  0.148   0.068<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> AAPL   2010-04-30  0.111   0.012<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> AAPL   2010-05-28 -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">1</span> -<span style="color: #BB0000;">0.074</span><span style="color: #BB0000; text-decoration: underline;">8</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> AAPL   2010-06-30 -<span style="color: #BB0000;">0.020</span><span style="color: #BB0000; text-decoration: underline;">8</span> -<span style="color: #BB0000;">0.054</span><span style="color: #BB0000; text-decoration: underline;">0</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> AAPL   2010-07-30  0.022<span style="text-decoration: underline;">7</span>  0.074<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> AAPL   2010-08-31 -<span style="color: #BB0000;">0.055</span><span style="color: #BB0000; text-decoration: underline;">0</span> -<span style="color: #BB0000;">0.056</span><span style="color: #BB0000; text-decoration: underline;">1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> AAPL   2010-09-30  0.167   0.117 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> AAPL   2010-10-29  0.060<span style="text-decoration: underline;">7</span>  0.057<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 206 more rows</span></span></span></code></pre>
<p>Finally, we can retrieve the performance metrics using
<code><a href="../reference/tq_performance.html">tq_performance()</a></code>. You can use
<code><a href="../reference/tq_performance.html">tq_performance_fun_options()</a></code> to see the full list of
compatible performance functions.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RaRb_capm</span> <span class="op">&lt;-</span> <span class="va">RaRb</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_performance.html">tq_performance</a></span><span class="op">(</span>Ra <span class="op">=</span> <span class="va">Ra</span>, </span>
<span>                   Rb <span class="op">=</span> <span class="va">Rb</span>, </span>
<span>                   performance_fun <span class="op">=</span> <span class="va">table.CAPM</span><span class="op">)</span></span>
<span><span class="va">RaRb_capm</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 13</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   symbol [3]</span></span></span>
<span><span class="co">##   symbol ActivePremium  Alpha AnnualizedAlpha  Beta `Beta-` `Beta+` Correlation</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> AAPL           0.119 0.008<span style="text-decoration: underline;">9</span>           0.112 1.11    0.578  1.04        0.659 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> GOOG           0.034 0.002<span style="text-decoration: underline;">8</span>           0.034 1.14    1.39   1.16        0.644 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> NFLX           0.447 0.053            0.859 0.384  -<span style="color: #BB0000;">1.52</span>   0.004<span style="text-decoration: underline;">5</span>      0.081<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 5 more variables: `Correlationp-value` &lt;dbl&gt;, InformationRatio &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   `R-squared` &lt;dbl&gt;, TrackingError &lt;dbl&gt;, TreynorRatio &lt;dbl&gt;</span></span></span></code></pre>
<p>We can quickly isolate attributes, such as alpha, the measure of
growth, and beta, the measure of risk.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RaRb_capm</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">symbol</span>, <span class="va">Alpha</span>, <span class="va">Beta</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   symbol [3]</span></span></span>
<span><span class="co">##   symbol  Alpha  Beta</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> AAPL   0.008<span style="text-decoration: underline;">9</span> 1.11 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> GOOG   0.002<span style="text-decoration: underline;">8</span> 1.14 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> NFLX   0.053  0.384</span></span></code></pre>
<p>With <code>tidyquant</code> it’s efficient and easy to get the CAPM
information! And, that’s just one of 129 available functions to analyze
stock and portfolio return performance. Just use
<code><a href="../reference/tq_performance.html">tq_performance_fun_options()</a></code> to see the full list.</p>
<p><a class="anchor" id="workflow"></a></p>
</div>
<div class="section level2">
<h2 id="workflow">3.0 Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h2>
<p>The general workflow is shown in the diagram below. We’ll step
through the workflow first with a group of individual assets (stocks)
and then with portfolios of stocks.</p>
<div class="float">
<img src="perfomance_analysis_workflow.png" alt="Performance Analysis Workflow"><div class="figcaption">Performance Analysis Workflow</div>
</div>
<div class="section level3">
<h3 id="individual-assets">3.1 Individual Assets<a class="anchor" aria-label="anchor" href="#individual-assets"></a>
</h3>
<p>Individual assets are the simplest form of analysis because there is
no portfolio aggregation (Step 3A). We’ll re-do the “Quick Example” this
time getting the <strong>Sharpe Ratio</strong>, a measure of
reward-to-risk.</p>
<p>Before we get started let’s find the performance function we want to
use from <code>PerformanceAnalytics</code>. Searching
<code>tq_performance_fun_options</code>, we can see that
<code>SharpeRatio</code> is available. Type <code>?SharpeRatio</code>,
and we can see that the arguments are:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/args.html" class="external-link">args</a></span><span class="op">(</span><span class="va">SharpeRatio</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## function (R, Rf = 0, p = 0.95, FUN = c("StdDev", "VaR", "ES"), </span></span>
<span><span class="co">##     weights = NULL, annualize = FALSE, SE = FALSE, SE.control = NULL, </span></span>
<span><span class="co">##     ...) </span></span>
<span><span class="co">## NULL</span></span></code></pre>
<p>We can actually skip the baseline path because the function does not
require <code>Rb</code>. The function takes <code>R</code>, which is
passed using <code>Ra</code> in
<code>tq_performance(Ra, Rb, performance_fun, ...)</code>. A little bit
of foresight saves us some work.</p>
<div class="section level4">
<h4 id="step-1a-get-stock-prices">Step 1A: Get stock prices<a class="anchor" aria-label="anchor" href="#step-1a-get-stock-prices"></a>
</h4>
<p>Use <code><a href="../reference/tq_get.html">tq_get()</a></code> to get stock prices.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stock_prices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AAPL"</span>, <span class="st">"GOOG"</span>, <span class="st">"NFLX"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span>get  <span class="op">=</span> <span class="st">"stock.prices"</span>,</span>
<span>           from <span class="op">=</span> <span class="st">"2010-01-01"</span>,</span>
<span>           to   <span class="op">=</span> <span class="st">"2015-12-31"</span><span class="op">)</span></span>
<span><span class="va">stock_prices</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4,527 × 8</span></span></span>
<span><span class="co">##    symbol date        open  high   low close    volume adjusted</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> AAPL   2010-01-04  7.62  7.66  7.59  7.64 493<span style="text-decoration: underline;">729</span>600     6.46</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> AAPL   2010-01-05  7.66  7.70  7.62  7.66 601<span style="text-decoration: underline;">904</span>800     6.47</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> AAPL   2010-01-06  7.66  7.69  7.53  7.53 552<span style="text-decoration: underline;">160</span>000     6.37</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> AAPL   2010-01-07  7.56  7.57  7.47  7.52 477<span style="text-decoration: underline;">131</span>200     6.36</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> AAPL   2010-01-08  7.51  7.57  7.47  7.57 447<span style="text-decoration: underline;">610</span>800     6.40</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> AAPL   2010-01-11  7.60  7.61  7.44  7.50 462<span style="text-decoration: underline;">229</span>600     6.34</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> AAPL   2010-01-12  7.47  7.49  7.37  7.42 594<span style="text-decoration: underline;">459</span>600     6.27</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> AAPL   2010-01-13  7.42  7.53  7.29  7.52 605<span style="text-decoration: underline;">892</span>000     6.36</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> AAPL   2010-01-14  7.50  7.52  7.47  7.48 432<span style="text-decoration: underline;">894</span>000     6.32</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> AAPL   2010-01-15  7.53  7.56  7.35  7.35 594<span style="text-decoration: underline;">067</span>600     6.22</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 4,517 more rows</span></span></span></code></pre>
</div>
<div class="section level4">
<h4 id="step-2a-mutate-to-returns">Step 2A: Mutate to returns<a class="anchor" aria-label="anchor" href="#step-2a-mutate-to-returns"></a>
</h4>
<p>Using the <code>tidyverse</code> split, apply, combine framework, we
can mutate groups of stocks by first “grouping” with
<code>group_by</code> and then applying a mutating function using
<code>tq_transmute</code>. We use the <code>quantmod</code> function
<code>periodReturn</code> as the mutating function. We pass along the
arguments <code>period = "monthly"</code> to return the results in
monthly periodicity. Last, we use the <code>col_rename</code> argument
to rename the output column.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stock_returns_monthly</span> <span class="op">&lt;-</span> <span class="va">stock_prices</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">symbol</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_mutate.html">tq_transmute</a></span><span class="op">(</span>select     <span class="op">=</span> <span class="va">adjusted</span>, </span>
<span>                 mutate_fun <span class="op">=</span> <span class="va">periodReturn</span>, </span>
<span>                 period     <span class="op">=</span> <span class="st">"monthly"</span>, </span>
<span>                 col_rename <span class="op">=</span> <span class="st">"Ra"</span><span class="op">)</span></span>
<span><span class="va">stock_returns_monthly</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 216 × 3</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   symbol [3]</span></span></span>
<span><span class="co">##    symbol date            Ra</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> AAPL   2010-01-29 -<span style="color: #BB0000;">0.103</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> AAPL   2010-02-26  0.065<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> AAPL   2010-03-31  0.148 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> AAPL   2010-04-30  0.111 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> AAPL   2010-05-28 -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> AAPL   2010-06-30 -<span style="color: #BB0000;">0.020</span><span style="color: #BB0000; text-decoration: underline;">8</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> AAPL   2010-07-30  0.022<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> AAPL   2010-08-31 -<span style="color: #BB0000;">0.055</span><span style="color: #BB0000; text-decoration: underline;">0</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> AAPL   2010-09-30  0.167 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> AAPL   2010-10-29  0.060<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 206 more rows</span></span></span></code></pre>
</div>
<div class="section level4">
<h4 id="step-3a-aggregate-to-portfolio-returns-skipped">Step 3A: Aggregate to Portfolio Returns (Skipped)<a class="anchor" aria-label="anchor" href="#step-3a-aggregate-to-portfolio-returns-skipped"></a>
</h4>
<p>Step 3A can be skipped because we are only interested in the Sharpe
Ratio for <em>individual stocks</em> (not a portfolio).</p>
<p>Step 3B can also be skipped because the <code>SharpeRatio</code>
function from <code>PerformanceAnalytics</code> does not require a
baseline.</p>
</div>
<div class="section level4">
<h4 id="step-4-analyze-performance">Step 4: Analyze Performance<a class="anchor" aria-label="anchor" href="#step-4-analyze-performance"></a>
</h4>
<p>The last step is to apply the <code>SharpeRatio</code> function to
our groups of stock returns. We do this using
<code><a href="../reference/tq_performance.html">tq_performance()</a></code> with the arguments <code>Ra = Ra</code>,
<code>Rb = NULL</code> (not required), and
<code>performance_fun = SharpeRatio</code>. We can also pass other
arguments of the <code>SharpeRatio</code> function such as
<code>Rf</code>, <code>p</code>, <code>FUN</code>, and
<code>annualize</code>. We will just use the defaults for this
example.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stock_returns_monthly</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_performance.html">tq_performance</a></span><span class="op">(</span></span>
<span>        Ra <span class="op">=</span> <span class="va">Ra</span>, </span>
<span>        Rb <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>        performance_fun <span class="op">=</span> <span class="va">SharpeRatio</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   symbol [3]</span></span></span>
<span><span class="co">##   symbol `ESSharpe(Rf=0%,p=95%)` StdDevSharpe(Rf=0%,p=9…¹ VaRSharpe(Rf=0%,p=95…²</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> AAPL                     0.173                    0.292                  0.218</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> GOOG                     0.129                    0.203                  0.157</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> NFLX                     0.237                    0.284                  0.272</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ abbreviated names: ¹​`StdDevSharpe(Rf=0%,p=95%)`, ²​`VaRSharpe(Rf=0%,p=95%)`</span></span></span></code></pre>
<p>Now we have the Sharpe Ratio for each of the three stocks. What if we
want to adjust the parameters of the function? We can just add on the
arguments of the underlying function.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stock_returns_monthly</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_performance.html">tq_performance</a></span><span class="op">(</span></span>
<span>        Ra <span class="op">=</span> <span class="va">Ra</span>, </span>
<span>        Rb <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>        performance_fun <span class="op">=</span> <span class="va">SharpeRatio</span>, </span>
<span>        Rf <span class="op">=</span> <span class="fl">0.03</span> <span class="op">/</span> <span class="fl">12</span>, </span>
<span>        p  <span class="op">=</span> <span class="fl">0.99</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   symbol [3]</span></span></span>
<span><span class="co">##   symbol `ESSharpe(Rf=0.2%,p=99%)` StdDevSharpe(Rf=0.2%…¹ VaRSharpe(Rf=0.2%,p=…²</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> AAPL                      0.116                   0.258                 0.134 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> GOOG                      0.082<span style="text-decoration: underline;">6</span>                  0.170                 0.099<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> NFLX                      0.115                   0.272                 0.142 </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ abbreviated names: ¹​`StdDevSharpe(Rf=0.2%,p=99%)`,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   ²​`VaRSharpe(Rf=0.2%,p=99%)`</span></span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="portfolios-asset-groups">3.2 Portfolios (Asset Groups)<a class="anchor" aria-label="anchor" href="#portfolios-asset-groups"></a>
</h3>
<p>Portfolios are slightly more complicated because we are now dealing
with groups of assets versus individual stocks, and we need to aggregate
weighted returns. Fortunately, this is only one extra step with
<code>tidyquant</code> using <code><a href="../reference/tq_portfolio.html">tq_portfolio()</a></code>.</p>
<div class="section level4">
<h4 id="single-portfolio">Single Portfolio<a class="anchor" aria-label="anchor" href="#single-portfolio"></a>
</h4>
<p>Let’s recreate the CAPM analysis in the “Quick Example” this time
comparing a portfolio of technology stocks to the SPDR Technology ETF
(XLK).</p>
<div class="section level5">
<h5 id="steps-1a-and-2a-asset-period-returns">Steps 1A and 2A: Asset Period Returns<a class="anchor" aria-label="anchor" href="#steps-1a-and-2a-asset-period-returns"></a>
</h5>
<p>This is the same as what we did previously to get the monthly returns
for groups of individual stock prices. We use the split, apply, combine
framework using the workflow of <code>tq_get</code>,
<code>group_by</code>, and <code>tq_transmute</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stock_returns_monthly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AAPL"</span>, <span class="st">"GOOG"</span>, <span class="st">"NFLX"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span>get  <span class="op">=</span> <span class="st">"stock.prices"</span>,</span>
<span>           from <span class="op">=</span> <span class="st">"2010-01-01"</span>,</span>
<span>           to   <span class="op">=</span> <span class="st">"2015-12-31"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">symbol</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_mutate.html">tq_transmute</a></span><span class="op">(</span>select     <span class="op">=</span> <span class="va">adjusted</span>, </span>
<span>                 mutate_fun <span class="op">=</span> <span class="va">periodReturn</span>, </span>
<span>                 period     <span class="op">=</span> <span class="st">"monthly"</span>, </span>
<span>                 col_rename <span class="op">=</span> <span class="st">"Ra"</span><span class="op">)</span></span>
<span><span class="va">stock_returns_monthly</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 216 × 3</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   symbol [3]</span></span></span>
<span><span class="co">##    symbol date            Ra</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> AAPL   2010-01-29 -<span style="color: #BB0000;">0.103</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> AAPL   2010-02-26  0.065<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> AAPL   2010-03-31  0.148 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> AAPL   2010-04-30  0.111 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> AAPL   2010-05-28 -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> AAPL   2010-06-30 -<span style="color: #BB0000;">0.020</span><span style="color: #BB0000; text-decoration: underline;">8</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> AAPL   2010-07-30  0.022<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> AAPL   2010-08-31 -<span style="color: #BB0000;">0.055</span><span style="color: #BB0000; text-decoration: underline;">0</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> AAPL   2010-09-30  0.167 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> AAPL   2010-10-29  0.060<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 206 more rows</span></span></span></code></pre>
</div>
<div class="section level5">
<h5 id="steps-1b-and-2b-baseline-period-returns">Steps 1B and 2B: Baseline Period Returns<a class="anchor" aria-label="anchor" href="#steps-1b-and-2b-baseline-period-returns"></a>
</h5>
<p>This was also done previously.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">baseline_returns_monthly</span> <span class="op">&lt;-</span> <span class="st">"XLK"</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span>get  <span class="op">=</span> <span class="st">"stock.prices"</span>,</span>
<span>           from <span class="op">=</span> <span class="st">"2010-01-01"</span>,</span>
<span>           to   <span class="op">=</span> <span class="st">"2015-12-31"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_mutate.html">tq_transmute</a></span><span class="op">(</span>select     <span class="op">=</span> <span class="va">adjusted</span>, </span>
<span>                 mutate_fun <span class="op">=</span> <span class="va">periodReturn</span>, </span>
<span>                 period     <span class="op">=</span> <span class="st">"monthly"</span>, </span>
<span>                 col_rename <span class="op">=</span> <span class="st">"Rb"</span><span class="op">)</span></span>
<span><span class="va">baseline_returns_monthly</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 72 × 2</span></span></span>
<span><span class="co">##    date            Rb</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 2010-01-29 -<span style="color: #BB0000;">0.099</span><span style="color: #BB0000; text-decoration: underline;">3</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 2010-02-26  0.034<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 2010-03-31  0.068<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 2010-04-30  0.012<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 2010-05-28 -<span style="color: #BB0000;">0.074</span><span style="color: #BB0000; text-decoration: underline;">8</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 2010-06-30 -<span style="color: #BB0000;">0.054</span><span style="color: #BB0000; text-decoration: underline;">0</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 2010-07-30  0.074<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 2010-08-31 -<span style="color: #BB0000;">0.056</span><span style="color: #BB0000; text-decoration: underline;">1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 2010-09-30  0.117 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 2010-10-29  0.057<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 62 more rows</span></span></span></code></pre>
</div>
<div class="section level5">
<h5 id="step-3a-aggregate-to-portfolio-period-returns">Step 3A: Aggregate to Portfolio Period Returns<a class="anchor" aria-label="anchor" href="#step-3a-aggregate-to-portfolio-period-returns"></a>
</h5>
<p>The <code>tidyquant</code> function, <code><a href="../reference/tq_portfolio.html">tq_portfolio()</a></code>
aggregates a group of individual assets into a single return using a
weighted composition of the underlying assets. To do this we need to
first develop portfolio weights. There are two ways to do this for a
single portfolio:</p>
<ol style="list-style-type: decimal">
<li>Supplying a vector of weights</li>
<li>Supplying a two column tidy data frame (tibble) with stock symbols
in the first column and weights to map in the second.</li>
</ol>
<p>Suppose we want to split our portfolio evenly between AAPL and NFLX.
We’ll show this using both methods.</p>
<div class="section level6">
<h6 id="method-1-aggregating-a-portfolio-using-vector-of-weights">Method 1: Aggregating a Portfolio using Vector of Weights<a class="anchor" aria-label="anchor" href="#method-1-aggregating-a-portfolio-using-vector-of-weights"></a>
</h6>
<p>We’ll use the weight vector, <code>c(0.5, 0, 0.5)</code>. Two
important aspects to supplying a numeric vector of weights: First,
notice that the length (3) is equal to the number of assets (3). This is
a requirement. Second, notice that the sum of the weighting vector is
equal to 1. This is not “required”, but is best practice. If the sum is
not 1, the weights will be distributed accordingly by scaling the vector
to 1, and a warning message will appear.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.0</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">portfolio_returns_monthly</span> <span class="op">&lt;-</span> <span class="va">stock_returns_monthly</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_portfolio.html">tq_portfolio</a></span><span class="op">(</span>assets_col  <span class="op">=</span> <span class="va">symbol</span>, </span>
<span>                 returns_col <span class="op">=</span> <span class="va">Ra</span>, </span>
<span>                 weights     <span class="op">=</span> <span class="va">wts</span>, </span>
<span>                 col_rename  <span class="op">=</span> <span class="st">"Ra"</span><span class="op">)</span></span>
<span><span class="va">portfolio_returns_monthly</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 72 × 2</span></span></span>
<span><span class="co">##    date            Ra</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 2010-01-29  0.030<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 2010-02-26  0.062<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 2010-03-31  0.130 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 2010-04-30  0.239 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 2010-05-28  0.068<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 2010-06-30 -<span style="color: #BB0000;">0.021</span><span style="color: #BB0000; text-decoration: underline;">9</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 2010-07-30 -<span style="color: #BB0000;">0.027</span><span style="color: #BB0000; text-decoration: underline;">2</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 2010-08-31  0.116 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 2010-09-30  0.251 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 2010-10-29  0.067<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 62 more rows</span></span></span></code></pre>
<p>We now have an aggregated portfolio that is a 50/50 blend of AAPL and
NFLX.</p>
<p>You may be asking why didn’t we use GOOG? <strong>The important thing
to understand is that all of the assets from the asset returns don’t
need to be used when creating the portfolio!</strong> This enables us to
scale individual stock returns and then vary weights to optimize the
portfolio (this will be a further subject that we address in the
future!)</p>
</div>
<div class="section level6">
<h6 id="method-2-aggregating-a-portfolio-using-two-column-tibble-with-symbols-and-weights">Method 2: Aggregating a Portfolio using Two Column tibble with
Symbols and Weights<a class="anchor" aria-label="anchor" href="#method-2-aggregating-a-portfolio-using-two-column-tibble-with-symbols-and-weights"></a>
</h6>
<p>A possibly more useful method of aggregating returns is using a
tibble of symbols and weights that are mapped to the portfolio. We’ll
recreate the previous portfolio example using mapped weights.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wts_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    symbols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AAPL"</span>, <span class="st">"NFLX"</span><span class="op">)</span>,</span>
<span>    weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">wts_map</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">##   symbols weights</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> AAPL        0.5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> NFLX        0.5</span></span></code></pre>
<p>Next, supply this two column tibble, with symbols in the first column
and weights in the second, to the <code>weights</code> argument in
<code><a href="../reference/tq_performance.html">tq_performance()</a></code>.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stock_returns_monthly</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_portfolio.html">tq_portfolio</a></span><span class="op">(</span>assets_col  <span class="op">=</span> <span class="va">symbol</span>, </span>
<span>                 returns_col <span class="op">=</span> <span class="va">Ra</span>, </span>
<span>                 weights     <span class="op">=</span> <span class="va">wts_map</span>, </span>
<span>                 col_rename  <span class="op">=</span> <span class="st">"Ra_using_wts_map"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 72 × 2</span></span></span>
<span><span class="co">##    date       Ra_using_wts_map</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 2010-01-29           0.030<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 2010-02-26           0.062<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 2010-03-31           0.130 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 2010-04-30           0.239 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 2010-05-28           0.068<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 2010-06-30          -<span style="color: #BB0000;">0.021</span><span style="color: #BB0000; text-decoration: underline;">9</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 2010-07-30          -<span style="color: #BB0000;">0.027</span><span style="color: #BB0000; text-decoration: underline;">2</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 2010-08-31           0.116 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 2010-09-30           0.251 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 2010-10-29           0.067<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 62 more rows</span></span></span></code></pre>
<p>The aggregated returns are exactly the same. The advantage with this
method is that not all symbols need to be specified. Any symbol not
specified by default gets a weight of zero.</p>
<p>Now, imagine if you had an entire index, such as the Russell 2000, of
2000 individual stock returns in a nice tidy data frame. It would be
very easy to adjust portfolios and compute blended returns, and you only
need to supply the symbols that you want to blend. All other symbols
default to zero!</p>
</div>
</div>
<div class="section level5">
<h5 id="step-3b-merging-ra-and-rb">Step 3B: Merging Ra and Rb<a class="anchor" aria-label="anchor" href="#step-3b-merging-ra-and-rb"></a>
</h5>
<p>Now that we have the aggregated portfolio returns (“Ra”) from Step 3A
and the baseline returns (“Rb”) from Step 2B, we can merge to get our
consolidated table of asset and baseline returns. Nothing new here.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RaRb_single_portfolio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">portfolio_returns_monthly</span>, </span>
<span>                                   <span class="va">baseline_returns_monthly</span>,</span>
<span>                                   by <span class="op">=</span> <span class="st">"date"</span><span class="op">)</span></span>
<span><span class="va">RaRb_single_portfolio</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 72 × 3</span></span></span>
<span><span class="co">##    date            Ra      Rb</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 2010-01-29  0.030<span style="text-decoration: underline;">7</span> -<span style="color: #BB0000;">0.099</span><span style="color: #BB0000; text-decoration: underline;">3</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 2010-02-26  0.062<span style="text-decoration: underline;">9</span>  0.034<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 2010-03-31  0.130   0.068<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 2010-04-30  0.239   0.012<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 2010-05-28  0.068<span style="text-decoration: underline;">2</span> -<span style="color: #BB0000;">0.074</span><span style="color: #BB0000; text-decoration: underline;">8</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 2010-06-30 -<span style="color: #BB0000;">0.021</span><span style="color: #BB0000; text-decoration: underline;">9</span> -<span style="color: #BB0000;">0.054</span><span style="color: #BB0000; text-decoration: underline;">0</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 2010-07-30 -<span style="color: #BB0000;">0.027</span><span style="color: #BB0000; text-decoration: underline;">2</span>  0.074<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 2010-08-31  0.116  -<span style="color: #BB0000;">0.056</span><span style="color: #BB0000; text-decoration: underline;">1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 2010-09-30  0.251   0.117 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 2010-10-29  0.067<span style="text-decoration: underline;">4</span>  0.057<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 62 more rows</span></span></span></code></pre>
</div>
<div class="section level5">
<h5 id="step-4-computing-the-capm-table">Step 4: Computing the CAPM Table<a class="anchor" aria-label="anchor" href="#step-4-computing-the-capm-table"></a>
</h5>
<p>The CAPM table is computed with the function <code>table.CAPM</code>
from <code>PerformanceAnalytics</code>. We just perform the same task
that we performed in the “Quick Example”.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RaRb_single_portfolio</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_performance.html">tq_performance</a></span><span class="op">(</span>Ra <span class="op">=</span> <span class="va">Ra</span>, Rb <span class="op">=</span> <span class="va">Rb</span>, performance_fun <span class="op">=</span> <span class="va">table.CAPM</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 12</span></span></span>
<span><span class="co">##   ActivePremium  Alpha AnnualizedAlpha  Beta `Beta-` `Beta+` Correlation</span></span>
<span><span class="co">##           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         0.327 0.029<span style="text-decoration: underline;">9</span>           0.425 0.754  -<span style="color: #BB0000;">0.243</span>   0.503       0.283</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 5 more variables: `Correlationp-value` &lt;dbl&gt;, InformationRatio &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   `R-squared` &lt;dbl&gt;, TrackingError &lt;dbl&gt;, TreynorRatio &lt;dbl&gt;</span></span></span></code></pre>
<p>Now we have the CAPM performance metrics for a portfolio! While this
is cool, it’s cooler to do multiple portfolios. Let’s see how.</p>
</div>
</div>
<div class="section level4">
<h4 id="multiple-portfolios">Multiple Portfolios<a class="anchor" aria-label="anchor" href="#multiple-portfolios"></a>
</h4>
<p>Once you understand the process for a single portfolio using Step 3A,
Method 2 (aggregating weights by mapping), scaling to multiple
portfolios is just building on this concept. Let’s recreate the same
example from the “Single Portfolio” Example this time with three
portfolios:</p>
<ol style="list-style-type: decimal">
<li>50% AAPL, 25% GOOG, 25% NFLX</li>
<li>25% AAPL, 50% GOOG, 25% NFLX</li>
<li>25% AAPL, 25% GOOG, 50% NFLX</li>
</ol>
<div class="section level5">
<h5 id="steps-1-and-2-are-the-exact-same-as-the-single-portfolio-example">Steps 1 and 2 are the Exact Same as the Single Portfolio
Example<a class="anchor" aria-label="anchor" href="#steps-1-and-2-are-the-exact-same-as-the-single-portfolio-example"></a>
</h5>
<p>First, get individual asset returns grouped by asset, which is the
exact same as Steps 1A and 1B from the Single Portfolio example.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stock_returns_monthly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AAPL"</span>, <span class="st">"GOOG"</span>, <span class="st">"NFLX"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span>get  <span class="op">=</span> <span class="st">"stock.prices"</span>,</span>
<span>           from <span class="op">=</span> <span class="st">"2010-01-01"</span>,</span>
<span>           to   <span class="op">=</span> <span class="st">"2015-12-31"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">symbol</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_mutate.html">tq_transmute</a></span><span class="op">(</span>select     <span class="op">=</span> <span class="va">adjusted</span>, </span>
<span>                 mutate_fun <span class="op">=</span> <span class="va">periodReturn</span>, </span>
<span>                 period     <span class="op">=</span> <span class="st">"monthly"</span>, </span>
<span>                 col_rename <span class="op">=</span> <span class="st">"Ra"</span><span class="op">)</span></span></code></pre></div>
<p>Second, get baseline asset returns, which is the exact same as Steps
1B and 2B from the Single Portfolio example.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">baseline_returns_monthly</span> <span class="op">&lt;-</span> <span class="st">"XLK"</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_get.html">tq_get</a></span><span class="op">(</span>get  <span class="op">=</span> <span class="st">"stock.prices"</span>,</span>
<span>           from <span class="op">=</span> <span class="st">"2010-01-01"</span>,</span>
<span>           to   <span class="op">=</span> <span class="st">"2015-12-31"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_mutate.html">tq_transmute</a></span><span class="op">(</span>select     <span class="op">=</span> <span class="va">adjusted</span>, </span>
<span>                 mutate_fun <span class="op">=</span> <span class="va">periodReturn</span>, </span>
<span>                 period     <span class="op">=</span> <span class="st">"monthly"</span>, </span>
<span>                 col_rename <span class="op">=</span> <span class="st">"Rb"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="step-3a-aggregate-portfolio-returns-for-multiple-portfolios">Step 3A: Aggregate Portfolio Returns for Multiple Portfolios<a class="anchor" aria-label="anchor" href="#step-3a-aggregate-portfolio-returns-for-multiple-portfolios"></a>
</h5>
<p>This is where it gets fun. If you picked up on Single Portfolio,
Step3A, Method 2 (mapping weights), this is just an extension for
multiple portfolios.</p>
<p>First, we need to grow our portfolios. <code>tidyquant</code> has a
handy, albeit simple, function, <code><a href="../reference/tq_portfolio.html">tq_repeat_df()</a></code>, for scaling
a single portfolio to many. It takes a data frame, and the number of
repeats, <code>n</code>, and the <code>index_col_name</code>, which adds
a sequential index. Let’s see how it works for our example. We need
three portfolios:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stock_returns_monthly_multi</span> <span class="op">&lt;-</span> <span class="va">stock_returns_monthly</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_portfolio.html">tq_repeat_df</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">stock_returns_monthly_multi</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 648 × 4</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   portfolio [3]</span></span></span>
<span><span class="co">##    portfolio symbol date            Ra</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>         1 AAPL   2010-01-29 -<span style="color: #BB0000;">0.103</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>         1 AAPL   2010-02-26  0.065<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>         1 AAPL   2010-03-31  0.148 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>         1 AAPL   2010-04-30  0.111 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>         1 AAPL   2010-05-28 -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>         1 AAPL   2010-06-30 -<span style="color: #BB0000;">0.020</span><span style="color: #BB0000; text-decoration: underline;">8</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>         1 AAPL   2010-07-30  0.022<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>         1 AAPL   2010-08-31 -<span style="color: #BB0000;">0.055</span><span style="color: #BB0000; text-decoration: underline;">0</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>         1 AAPL   2010-09-30  0.167 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>         1 AAPL   2010-10-29  0.060<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 638 more rows</span></span></span></code></pre>
<p>Examining the results, we can see that a few things happened:</p>
<ol style="list-style-type: decimal">
<li>The length (number of rows) has tripled. This is the essence of
<code>tq_repeat_df</code>: it grows the data frame length-wise,
repeating the data frame <code>n</code> times. In our case,
<code>n = 3</code>.</li>
<li>Our data frame, which was grouped by symbol, was ungrouped. This is
needed to prevent <code>tq_portfolio</code> from blending on the
individual stocks. <code>tq_portfolio</code> only works on groups of
stocks.</li>
<li>We have a new column, named “portfolio”. The “portfolio” column name
is a key that tells <code>tq_portfolio</code> that multiple groups exist
to analyze. Just note that for multiple portfolio analysis, the
“portfolio” column name is required.</li>
<li>We have three groups of portfolios. This is what
<code>tq_portfolio</code> will split, apply (aggregate), then combine
on.</li>
</ol>
<p>Now the tricky part: We need a new table of weights to map on.
There’s a few requirements:</p>
<ol style="list-style-type: decimal">
<li>We must supply a three column tibble with the following columns:
“portfolio”, asset, and weight in that order.</li>
<li>The “portfolio” column must be named “portfolio” since this is a key
name for mapping.</li>
<li>The tibble must be grouped by the portfolio column.</li>
</ol>
<p>Here’s what the weights table should look like for our example:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">0.50</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>,</span>
<span>    <span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.25</span>,</span>
<span>    <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.50</span></span>
<span><span class="op">)</span></span>
<span><span class="va">stocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AAPL"</span>, <span class="st">"GOOG"</span>, <span class="st">"NFLX"</span><span class="op">)</span></span>
<span><span class="va">weights_table</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="va">stocks</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_portfolio.html">tq_repeat_df</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">portfolio</span><span class="op">)</span></span>
<span><span class="va">weights_table</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 9 × 3</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   portfolio [3]</span></span></span>
<span><span class="co">##   portfolio stocks weights</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         1 AAPL      0.5 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         1 GOOG      0.25</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>         1 NFLX      0.25</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>         2 AAPL      0.25</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>         2 GOOG      0.5 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>         2 NFLX      0.25</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span>         3 AAPL      0.25</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span>         3 GOOG      0.25</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">9</span>         3 NFLX      0.5</span></span></code></pre>
<p>Now just pass the expanded <code>stock_returns_monthly_multi</code>
and the <code>weights_table</code> to <code>tq_portfolio</code> for
portfolio aggregation.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">portfolio_returns_monthly_multi</span> <span class="op">&lt;-</span> <span class="va">stock_returns_monthly_multi</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_portfolio.html">tq_portfolio</a></span><span class="op">(</span>assets_col  <span class="op">=</span> <span class="va">symbol</span>, </span>
<span>                 returns_col <span class="op">=</span> <span class="va">Ra</span>, </span>
<span>                 weights     <span class="op">=</span> <span class="va">weights_table</span>, </span>
<span>                 col_rename  <span class="op">=</span> <span class="st">"Ra"</span><span class="op">)</span></span>
<span><span class="va">portfolio_returns_monthly_multi</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 216 × 3</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   portfolio [3]</span></span></span>
<span><span class="co">##    portfolio date              Ra</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>         1 2010-01-29 -<span style="color: #BB0000;">0.048</span><span style="color: #BB0000; text-decoration: underline;">9</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>         1 2010-02-26  0.048<span style="text-decoration: underline;">2</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>         1 2010-03-31  0.123   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>         1 2010-04-30  0.145   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>         1 2010-05-28  0.024<span style="text-decoration: underline;">5</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>         1 2010-06-30 -<span style="color: #BB0000;">0.030</span><span style="color: #BB0000; text-decoration: underline;">8</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>         1 2010-07-30  0.000<span style="text-decoration: underline;">600</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>         1 2010-08-31  0.047<span style="text-decoration: underline;">4</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>         1 2010-09-30  0.222   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>         1 2010-10-29  0.078<span style="text-decoration: underline;">9</span>  </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 206 more rows</span></span></span></code></pre>
<p>Let’s assess the output. We now have a single, “long” format data
frame of portfolio returns. It has three groups with the aggregated
portfolios blended by mapping the <code>weights_table</code>.</p>
</div>
<div class="section level5">
<h5 id="steps-3b-and-4-merging-and-assessing-performance">Steps 3B and 4: Merging and Assessing Performance<a class="anchor" aria-label="anchor" href="#steps-3b-and-4-merging-and-assessing-performance"></a>
</h5>
<p>These steps are the exact same as the Single Portfolio example.</p>
<p>First, we merge with the baseline using “date” as the key.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RaRb_multiple_portfolio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">portfolio_returns_monthly_multi</span>, </span>
<span>                                     <span class="va">baseline_returns_monthly</span>,</span>
<span>                                     by <span class="op">=</span> <span class="st">"date"</span><span class="op">)</span></span>
<span><span class="va">RaRb_multiple_portfolio</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 216 × 4</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   portfolio [3]</span></span></span>
<span><span class="co">##    portfolio date              Ra      Rb</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>         1 2010-01-29 -<span style="color: #BB0000;">0.048</span><span style="color: #BB0000; text-decoration: underline;">9</span>   -<span style="color: #BB0000;">0.099</span><span style="color: #BB0000; text-decoration: underline;">3</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>         1 2010-02-26  0.048<span style="text-decoration: underline;">2</span>    0.034<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>         1 2010-03-31  0.123     0.068<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>         1 2010-04-30  0.145     0.012<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>         1 2010-05-28  0.024<span style="text-decoration: underline;">5</span>   -<span style="color: #BB0000;">0.074</span><span style="color: #BB0000; text-decoration: underline;">8</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>         1 2010-06-30 -<span style="color: #BB0000;">0.030</span><span style="color: #BB0000; text-decoration: underline;">8</span>   -<span style="color: #BB0000;">0.054</span><span style="color: #BB0000; text-decoration: underline;">0</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>         1 2010-07-30  0.000<span style="text-decoration: underline;">600</span>  0.074<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>         1 2010-08-31  0.047<span style="text-decoration: underline;">4</span>   -<span style="color: #BB0000;">0.056</span><span style="color: #BB0000; text-decoration: underline;">1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>         1 2010-09-30  0.222     0.117 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>         1 2010-10-29  0.078<span style="text-decoration: underline;">9</span>    0.057<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 206 more rows</span></span></span></code></pre>
<p>Finally, we calculate the performance of each of the portfolios using
<code>tq_performance</code>. Make sure the data frame is grouped on
“portfolio”.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RaRb_multiple_portfolio</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_performance.html">tq_performance</a></span><span class="op">(</span>Ra <span class="op">=</span> <span class="va">Ra</span>, Rb <span class="op">=</span> <span class="va">Rb</span>, performance_fun <span class="op">=</span> <span class="va">table.CAPM</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 13</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   portfolio [3]</span></span></span>
<span><span class="co">##   portfolio ActivePremium  Alpha AnnualizedAlpha  Beta `Beta-` `Beta+`</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         1         0.231 0.019<span style="text-decoration: underline;">3</span>           0.258 0.908   0.312   0.741</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         2         0.219 0.019<span style="text-decoration: underline;">2</span>           0.256 0.886   0.436   0.660</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>         3         0.319 0.030<span style="text-decoration: underline;">8</span>           0.439 0.721  -<span style="color: #BB0000;">0.179</span>   0.394</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 6 more variables: Correlation &lt;dbl&gt;, `Correlationp-value` &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   InformationRatio &lt;dbl&gt;, `R-squared` &lt;dbl&gt;, TrackingError &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   TreynorRatio &lt;dbl&gt;</span></span></span></code></pre>
<p>Inspecting the results, we now have a multiple portfolio comparison
of the CAPM table from <code>PerformanceAnalytics</code>. We can do the
same thing with <code>SharpeRatio</code> as well.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RaRb_multiple_portfolio</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_performance.html">tq_performance</a></span><span class="op">(</span>Ra <span class="op">=</span> <span class="va">Ra</span>, Rb <span class="op">=</span> <span class="cn">NULL</span>, performance_fun <span class="op">=</span> <span class="va">SharpeRatio</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   portfolio [3]</span></span></span>
<span><span class="co">##   portfolio ESSharpe(Rf=0%,p=95%…¹ StdDevSharpe(Rf=0%,p…² VaRSharpe(Rf=0%,p=95…³</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         1                  0.172                  0.355                  0.263</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         2                  0.146                  0.334                  0.236</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>         3                  0.150                  0.317                  0.238</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ abbreviated names: ¹​`ESSharpe(Rf=0%,p=95%)`, ²​`StdDevSharpe(Rf=0%,p=95%)`,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   ³​`VaRSharpe(Rf=0%,p=95%)`</span></span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="available-functions">4.0 Available Functions<a class="anchor" aria-label="anchor" href="#available-functions"></a>
</h2>
<p>We’ve only scratched the surface of the analysis functions available
through <code>PerformanceAnalytics</code>. The list below includes all
of the compatible functions grouped by function type. The table
functions are the most useful to get a cross section of metrics. We’ll
touch on a few. We’ll also go over <code>VaR</code> and
<code>SharpeRatio</code> as these are very commonly used as performance
measures.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tq_performance.html">tq_performance_fun_options</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $table.funs</span></span>
<span><span class="co">##  [1] "table.AnnualizedReturns" "table.Arbitrary"        </span></span>
<span><span class="co">##  [3] "table.Autocorrelation"   "table.CAPM"             </span></span>
<span><span class="co">##  [5] "table.CaptureRatios"     "table.Correlation"      </span></span>
<span><span class="co">##  [7] "table.Distributions"     "table.DownsideRisk"     </span></span>
<span><span class="co">##  [9] "table.DownsideRiskRatio" "table.DrawdownsRatio"   </span></span>
<span><span class="co">## [11] "table.HigherMoments"     "table.InformationRatio" </span></span>
<span><span class="co">## [13] "table.RollingPeriods"    "table.SFM"              </span></span>
<span><span class="co">## [15] "table.SpecificRisk"      "table.Stats"            </span></span>
<span><span class="co">## [17] "table.TrailingPeriods"   "table.UpDownRatios"     </span></span>
<span><span class="co">## [19] "table.Variability"      </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $CAPM.funs</span></span>
<span><span class="co">##  [1] "CAPM.alpha"       "CAPM.beta"        "CAPM.beta.bear"   "CAPM.beta.bull"  </span></span>
<span><span class="co">##  [5] "CAPM.CML"         "CAPM.CML.slope"   "CAPM.dynamic"     "CAPM.epsilon"    </span></span>
<span><span class="co">##  [9] "CAPM.jensenAlpha" "CAPM.RiskPremium" "CAPM.SML.slope"   "TimingRatio"     </span></span>
<span><span class="co">## [13] "MarketTiming"    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $SFM.funs</span></span>
<span><span class="co">## [1] "SFM.alpha"       "SFM.beta"        "SFM.CML"         "SFM.CML.slope"  </span></span>
<span><span class="co">## [5] "SFM.dynamic"     "SFM.epsilon"     "SFM.jensenAlpha"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $descriptive.funs</span></span>
<span><span class="co">## [1] "mean"           "sd"             "min"            "max"           </span></span>
<span><span class="co">## [5] "cor"            "mean.geometric" "mean.stderr"    "mean.LCL"      </span></span>
<span><span class="co">## [9] "mean.UCL"      </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $annualized.funs</span></span>
<span><span class="co">## [1] "Return.annualized"        "Return.annualized.excess"</span></span>
<span><span class="co">## [3] "sd.annualized"            "SharpeRatio.annualized"  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $VaR.funs</span></span>
<span><span class="co">## [1] "VaR"  "ES"   "ETL"  "CDD"  "CVaR"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $moment.funs</span></span>
<span><span class="co">##  [1] "var"              "cov"              "skewness"         "kurtosis"        </span></span>
<span><span class="co">##  [5] "CoVariance"       "CoSkewness"       "CoSkewnessMatrix" "CoKurtosis"      </span></span>
<span><span class="co">##  [9] "CoKurtosisMatrix" "M3.MM"            "M4.MM"            "BetaCoVariance"  </span></span>
<span><span class="co">## [13] "BetaCoSkewness"   "BetaCoKurtosis"  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $drawdown.funs</span></span>
<span><span class="co">## [1] "AverageDrawdown"   "AverageLength"     "AverageRecovery"  </span></span>
<span><span class="co">## [4] "DrawdownDeviation" "DrawdownPeak"      "maxDrawdown"      </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Bacon.risk.funs</span></span>
<span><span class="co">## [1] "MeanAbsoluteDeviation" "Frequency"             "SharpeRatio"          </span></span>
<span><span class="co">## [4] "MSquared"              "MSquaredExcess"        "HurstIndex"           </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Bacon.regression.funs</span></span>
<span><span class="co">##  [1] "CAPM.alpha"       "CAPM.beta"        "CAPM.epsilon"     "CAPM.jensenAlpha"</span></span>
<span><span class="co">##  [5] "SystematicRisk"   "SpecificRisk"     "TotalRisk"        "TreynorRatio"    </span></span>
<span><span class="co">##  [9] "AppraisalRatio"   "FamaBeta"         "Selectivity"      "NetSelectivity"  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Bacon.relative.risk.funs</span></span>
<span><span class="co">## [1] "ActivePremium"    "ActiveReturn"     "TrackingError"    "InformationRatio"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Bacon.drawdown.funs</span></span>
<span><span class="co">## [1] "PainIndex"     "PainRatio"     "CalmarRatio"   "SterlingRatio"</span></span>
<span><span class="co">## [5] "BurkeRatio"    "MartinRatio"   "UlcerIndex"   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Bacon.downside.risk.funs</span></span>
<span><span class="co">##  [1] "DownsideDeviation"     "DownsidePotential"     "DownsideFrequency"    </span></span>
<span><span class="co">##  [4] "SemiDeviation"         "SemiVariance"          "UpsideRisk"           </span></span>
<span><span class="co">##  [7] "UpsidePotentialRatio"  "UpsideFrequency"       "BernardoLedoitRatio"  </span></span>
<span><span class="co">## [10] "DRatio"                "Omega"                 "OmegaSharpeRatio"     </span></span>
<span><span class="co">## [13] "OmegaExcessReturn"     "SortinoRatio"          "M2Sortino"            </span></span>
<span><span class="co">## [16] "Kappa"                 "VolatilitySkewness"    "AdjustedSharpeRatio"  </span></span>
<span><span class="co">## [19] "SkewnessKurtosisRatio" "ProspectRatio"        </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $misc.funs</span></span>
<span><span class="co">## [1] "KellyRatio"   "Modigliani"   "UpDownRatios"</span></span></code></pre>
<div class="section level3">
<h3 id="table-stats">4.1 table.Stats<a class="anchor" aria-label="anchor" href="#table-stats"></a>
</h3>
<p>Returns a basic set of statistics that match the period of the data
passed in (e.g., monthly returns will get monthly statistics, daily will
be daily stats, and so on).</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RaRb_multiple_portfolio</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_performance.html">tq_performance</a></span><span class="op">(</span>Ra <span class="op">=</span> <span class="va">Ra</span>, Rb <span class="op">=</span> <span class="cn">NULL</span>, performance_fun <span class="op">=</span> <span class="va">table.Stats</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 17</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   portfolio [3]</span></span></span>
<span><span class="co">##   portfolio ArithmeticMean GeometricMean Kurtosis `LCLMean(0.95)` Maximum Median</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         1         0.029<span style="text-decoration: underline;">3</span>        0.025<span style="text-decoration: underline;">9</span>     1.14          0.009<span style="text-decoration: underline;">9</span>   0.222 0.030<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         2         0.029         0.025<span style="text-decoration: underline;">2</span>     1.65          0.008<span style="text-decoration: underline;">6</span>   0.227 0.037 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>         3         0.038<span style="text-decoration: underline;">8</span>        0.031<span style="text-decoration: underline;">3</span>     1.81          0.01     0.370 0.046 </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 10 more variables: Minimum &lt;dbl&gt;, NAs &lt;dbl&gt;, Observations &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   Quartile1 &lt;dbl&gt;, Quartile3 &lt;dbl&gt;, SEMean &lt;dbl&gt;, Skewness &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   Stdev &lt;dbl&gt;, `UCLMean(0.95)` &lt;dbl&gt;, Variance &lt;dbl&gt;</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="table-capm">4.2 table.CAPM<a class="anchor" aria-label="anchor" href="#table-capm"></a>
</h3>
<p>Takes a set of returns and relates them to a benchmark return.
Provides a set of measures related to an excess return single factor
model, or CAPM.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RaRb_multiple_portfolio</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_performance.html">tq_performance</a></span><span class="op">(</span>Ra <span class="op">=</span> <span class="va">Ra</span>, Rb <span class="op">=</span> <span class="va">Rb</span>, performance_fun <span class="op">=</span> <span class="va">table.CAPM</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 13</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   portfolio [3]</span></span></span>
<span><span class="co">##   portfolio ActivePremium  Alpha AnnualizedAlpha  Beta `Beta-` `Beta+`</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         1         0.231 0.019<span style="text-decoration: underline;">3</span>           0.258 0.908   0.312   0.741</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         2         0.219 0.019<span style="text-decoration: underline;">2</span>           0.256 0.886   0.436   0.660</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>         3         0.319 0.030<span style="text-decoration: underline;">8</span>           0.439 0.721  -<span style="color: #BB0000;">0.179</span>   0.394</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 6 more variables: Correlation &lt;dbl&gt;, `Correlationp-value` &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   InformationRatio &lt;dbl&gt;, `R-squared` &lt;dbl&gt;, TrackingError &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   TreynorRatio &lt;dbl&gt;</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="table-annualizedreturns">4.3 table.AnnualizedReturns<a class="anchor" aria-label="anchor" href="#table-annualizedreturns"></a>
</h3>
<p>Table of Annualized Return, Annualized Std Dev, and Annualized
Sharpe.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RaRb_multiple_portfolio</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_performance.html">tq_performance</a></span><span class="op">(</span>Ra <span class="op">=</span> <span class="va">Ra</span>, Rb <span class="op">=</span> <span class="cn">NULL</span>, performance_fun <span class="op">=</span> <span class="va">table.AnnualizedReturns</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   portfolio [3]</span></span></span>
<span><span class="co">##   portfolio AnnualizedReturn `AnnualizedSharpe(Rf=0%)` AnnualizedStdDev</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         1            0.360                      1.26            0.286</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         2            0.348                      1.16            0.301</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>         3            0.448                      1.06            0.424</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="table-correlation">4.4 table.Correlation<a class="anchor" aria-label="anchor" href="#table-correlation"></a>
</h3>
<p>This is a wrapper for calculating correlation and significance
against each column of the data provided.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RaRb_multiple_portfolio</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_performance.html">tq_performance</a></span><span class="op">(</span>Ra <span class="op">=</span> <span class="va">Ra</span>, Rb <span class="op">=</span> <span class="va">Rb</span>, performance_fun <span class="op">=</span> <span class="va">table.Correlation</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 5</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   portfolio [3]</span></span></span>
<span><span class="co">##   portfolio `p-value` `Lower CI` `Upper CI` to.Rb</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         1 0.000<span style="text-decoration: underline;">028</span>4     0.270       0.634 0.472</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         2 0.000<span style="text-decoration: underline;">122</span>      0.229       0.608 0.438</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>         3 0.032<span style="text-decoration: underline;">5</span>        0.022<span style="text-decoration: underline;">0</span>      0.457 0.252</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="table-downsiderisk">4.5 table.DownsideRisk<a class="anchor" aria-label="anchor" href="#table-downsiderisk"></a>
</h3>
<p>Creates a table of estimates of downside risk measures for comparison
across multiple instruments or funds.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RaRb_multiple_portfolio</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_performance.html">tq_performance</a></span><span class="op">(</span>Ra <span class="op">=</span> <span class="va">Ra</span>, Rb <span class="op">=</span> <span class="cn">NULL</span>, performance_fun <span class="op">=</span> <span class="va">table.DownsideRisk</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 12</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   portfolio [3]</span></span></span>
<span><span class="co">##   portfolio DownsideDeviation(0%…¹ DownsideDeviation(MA…² DownsideDeviation(Rf…³</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         1                 0.045                  0.048<span style="text-decoration: underline;">8</span>                 0.045 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         2                 0.050<span style="text-decoration: underline;">1</span>                 0.053<span style="text-decoration: underline;">8</span>                 0.050<span style="text-decoration: underline;">1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>         3                 0.068<span style="text-decoration: underline;">4</span>                 0.072<span style="text-decoration: underline;">1</span>                 0.068<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ abbreviated names: ¹​`DownsideDeviation(0%)`, ²​`DownsideDeviation(MAR=10%)`,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   ³​`DownsideDeviation(Rf=0%)`</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 8 more variables: GainDeviation &lt;dbl&gt;, `HistoricalES(95%)` &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   `HistoricalVaR(95%)` &lt;dbl&gt;, LossDeviation &lt;dbl&gt;, MaximumDrawdown &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   `ModifiedES(95%)` &lt;dbl&gt;, `ModifiedVaR(95%)` &lt;dbl&gt;, SemiDeviation &lt;dbl&gt;</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="table-downsideriskratio">4.6 table.DownsideRiskRatio<a class="anchor" aria-label="anchor" href="#table-downsideriskratio"></a>
</h3>
<p>Table of Monthly downside risk, Annualized downside risk, Downside
potential, Omega, Sortino ratio, Upside potential, Upside potential
ratio and Omega-Sharpe ratio.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RaRb_multiple_portfolio</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_performance.html">tq_performance</a></span><span class="op">(</span>Ra <span class="op">=</span> <span class="va">Ra</span>, Rb <span class="op">=</span> <span class="cn">NULL</span>, performance_fun <span class="op">=</span> <span class="va">table.DownsideRiskRatio</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 9</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   portfolio [3]</span></span></span>
<span><span class="co">##   portfolio Annualiseddownsiderisk Downsidepotential monthlydownsiderisk Omega</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         1                  0.156            0.019<span style="text-decoration: underline;">8</span>              0.045   2.48</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         2                  0.173            0.021<span style="text-decoration: underline;">7</span>              0.050<span style="text-decoration: underline;">1</span>  2.34</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>         3                  0.237            0.029<span style="text-decoration: underline;">4</span>              0.068<span style="text-decoration: underline;">4</span>  2.32</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 4 more variables: `Omega-sharperatio` &lt;dbl&gt;, Sortinoratio &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   Upsidepotential &lt;dbl&gt;, Upsidepotentialratio &lt;dbl&gt;</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="table-highermoments">4.7 table.HigherMoments<a class="anchor" aria-label="anchor" href="#table-highermoments"></a>
</h3>
<p>Summary of the higher moments and Co-Moments of the return
distribution. Used to determine diversification potential. Also called
“systematic” moments by several papers.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RaRb_multiple_portfolio</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_performance.html">tq_performance</a></span><span class="op">(</span>Ra <span class="op">=</span> <span class="va">Ra</span>, Rb <span class="op">=</span> <span class="va">Rb</span>, performance_fun <span class="op">=</span> <span class="va">table.HigherMoments</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 6</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   portfolio [3]</span></span></span>
<span><span class="co">##   portfolio BetaCoKurtosis BetaCoSkewness BetaCoVariance CoKurtosis CoSkewness</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         1          0.756          0.196          0.908          0          0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         2          0.772          1.71           0.886          0          0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>         3          0.455          0.369          0.721          0          0</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="table-informationratio">4.8 table.InformationRatio<a class="anchor" aria-label="anchor" href="#table-informationratio"></a>
</h3>
<p>Table of Tracking error, Annualized tracking error and Information
ratio.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RaRb_multiple_portfolio</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_performance.html">tq_performance</a></span><span class="op">(</span>Ra <span class="op">=</span> <span class="va">Ra</span>, Rb <span class="op">=</span> <span class="va">Rb</span>, performance_fun <span class="op">=</span> <span class="va">table.InformationRatio</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   portfolio [3]</span></span></span>
<span><span class="co">##   portfolio AnnualisedTrackingError InformationRatio TrackingError</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         1                   0.252            0.917        0.072<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         2                   0.271            0.809        0.078<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>         3                   0.412            0.774        0.119</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="table-variability">4.9 table.Variability<a class="anchor" aria-label="anchor" href="#table-variability"></a>
</h3>
<p>Table of Mean absolute difference, Monthly standard deviation and
annualized standard deviation.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RaRb_multiple_portfolio</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_performance.html">tq_performance</a></span><span class="op">(</span>Ra <span class="op">=</span> <span class="va">Ra</span>, Rb <span class="op">=</span> <span class="cn">NULL</span>, performance_fun <span class="op">=</span> <span class="va">table.Variability</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   portfolio [3]</span></span></span>
<span><span class="co">##   portfolio AnnualizedStdDev MeanAbsolutedeviation monthlyStdDev</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         1            0.286                0.065<span style="text-decoration: underline;">8</span>        0.082<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         2            0.301                0.067<span style="text-decoration: underline;">9</span>        0.086<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>         3            0.424                0.091         0.122</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="var">4.10 VaR<a class="anchor" aria-label="anchor" href="#var"></a>
</h3>
<p>Calculates Value-at-Risk (VaR) for univariate, component, and
marginal cases using a variety of analytical methods.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RaRb_multiple_portfolio</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_performance.html">tq_performance</a></span><span class="op">(</span>Ra <span class="op">=</span> <span class="va">Ra</span>, Rb <span class="op">=</span> <span class="cn">NULL</span>, performance_fun <span class="op">=</span> <span class="va">VaR</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   portfolio [3]</span></span></span>
<span><span class="co">##   portfolio    VaR</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         1 -<span style="color: #BB0000;">0.111</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         2 -<span style="color: #BB0000;">0.123</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>         3 -<span style="color: #BB0000;">0.163</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="sharperatio">4.11 SharpeRatio<a class="anchor" aria-label="anchor" href="#sharperatio"></a>
</h3>
<p>The Sharpe ratio is simply the return per unit of risk (represented
by variability). In the classic case, the unit of risk is the standard
deviation of the returns.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RaRb_multiple_portfolio</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_performance.html">tq_performance</a></span><span class="op">(</span>Ra <span class="op">=</span> <span class="va">Ra</span>, Rb <span class="op">=</span> <span class="cn">NULL</span>, performance_fun <span class="op">=</span> <span class="va">SharpeRatio</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   portfolio [3]</span></span></span>
<span><span class="co">##   portfolio ESSharpe(Rf=0%,p=95%…¹ StdDevSharpe(Rf=0%,p…² VaRSharpe(Rf=0%,p=95…³</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         1                  0.172                  0.355                  0.263</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         2                  0.146                  0.334                  0.236</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>         3                  0.150                  0.317                  0.238</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ abbreviated names: ¹​`ESSharpe(Rf=0%,p=95%)`, ²​`StdDevSharpe(Rf=0%,p=95%)`,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   ³​`VaRSharpe(Rf=0%,p=95%)`</span></span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="customizing-using-the">5.0 Customizing using the …<a class="anchor" aria-label="anchor" href="#customizing-using-the"></a>
</h2>
<p>One of the best features of <code>tq_portfolio</code> and
<code>tq_performance</code> is to be able to pass features through to
the underlying functions. After all, these are just wrappers for
<code>PerformanceAnalytics</code>, so you probably want to be able
<strong>to make full use of the underlying functions</strong>. Passing
through parameters using the <code>...</code> can be incredibly useful,
so let’s see how.</p>
<div class="section level3">
<h3 id="customizing-tq_portfolio">5.1 Customizing tq_portfolio<a class="anchor" aria-label="anchor" href="#customizing-tq_portfolio"></a>
</h3>
<p>The <code>tq_portfolio</code> function is a wrapper for
<code>Return.portfolio</code>. This means that during the portfolio
aggregation process, we can make use of most of the
<code>Return.portfolio</code> arguments such as
<code>wealth.index</code>, <code>contribution</code>,
<code>geometric</code>, <code>rebalance_on</code>, and
<code>value</code>. Here’s the arguments of the underlying function:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/args.html" class="external-link">args</a></span><span class="op">(</span><span class="va">Return.portfolio</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## function (R, weights = NULL, wealth.index = FALSE, contribution = FALSE, </span></span>
<span><span class="co">##     geometric = TRUE, rebalance_on = c(NA, "years", "quarters", </span></span>
<span><span class="co">##         "months", "weeks", "days"), value = 1, verbose = FALSE, </span></span>
<span><span class="co">##     ...) </span></span>
<span><span class="co">## NULL</span></span></code></pre>
<p>Let’s see an example of passing parameters to the <code>...</code>.
Suppose we want to instead see how our money is grows for a $10,000
investment. We’ll use the “Single Portfolio” example, where our
portfolio mix was 50% AAPL, 0% GOOG, and 50% NFLX.</p>
<p>Method 3A, Aggregating Portfolio Returns, showed us two methods to
aggregate for a single portfolio. Either will work for this example. For
simplicity, we’ll examine the first.</p>
<p>Here’s the original output, without adjusting parameters.</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.0</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">portfolio_returns_monthly</span> <span class="op">&lt;-</span> <span class="va">stock_returns_monthly</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_portfolio.html">tq_portfolio</a></span><span class="op">(</span>assets_col  <span class="op">=</span> <span class="va">symbol</span>, </span>
<span>                 returns_col <span class="op">=</span> <span class="va">Ra</span>, </span>
<span>                 weights     <span class="op">=</span> <span class="va">wts</span>, </span>
<span>                 col_rename  <span class="op">=</span> <span class="st">"Ra"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">portfolio_returns_monthly</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">Ra</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, fill <span class="op">=</span> <span class="fu"><a href="../reference/palette_tq.html">palette_light</a></span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Portfolio Returns"</span>,</span>
<span>         subtitle <span class="op">=</span> <span class="st">"50% AAPL, 0% GOOG, and 50% NFLX"</span>,</span>
<span>         caption <span class="op">=</span> <span class="st">"Shows an above-zero trend meaning positive returns"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Monthly Returns"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/theme_tq.html">theme_tq</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/scale_manual.html">scale_color_tq</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">)</span></span></code></pre></div>
<p><img src="TQ05-performance-analysis-with-tidyquant_files/figure-html/unnamed-chunk-44-1.png" width="95%" style="display: block; margin: auto;"></p>
<p>This is good, but we want to see how our $10,000 initial investment
is growing. This is simple with the underlying
<code>Return.portfolio</code> argument,
<code>wealth.index = TRUE</code>. All we need to do is add these as
additional parameters to <code>tq_portfolio</code>!</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">portfolio_growth_monthly</span> <span class="op">&lt;-</span> <span class="va">stock_returns_monthly</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_portfolio.html">tq_portfolio</a></span><span class="op">(</span>assets_col   <span class="op">=</span> <span class="va">symbol</span>, </span>
<span>                 returns_col  <span class="op">=</span> <span class="va">Ra</span>, </span>
<span>                 weights      <span class="op">=</span> <span class="va">wts</span>, </span>
<span>                 col_rename   <span class="op">=</span> <span class="st">"investment.growth"</span>,</span>
<span>                 wealth.index <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>investment.growth <span class="op">=</span> <span class="va">investment.growth</span> <span class="op">*</span> <span class="fl">10000</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">portfolio_growth_monthly</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">investment.growth</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="fu"><a href="../reference/palette_tq.html">palette_light</a></span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Portfolio Growth"</span>,</span>
<span>         subtitle <span class="op">=</span> <span class="st">"50% AAPL, 0% GOOG, and 50% NFLX"</span>,</span>
<span>         caption <span class="op">=</span> <span class="st">"Now we can really visualize performance!"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Portfolio Value"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/theme_tq.html">theme_tq</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/scale_manual.html">scale_color_tq</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/dollar_format.html" class="external-link">dollar</a></span><span class="op">)</span></span></code></pre></div>
<p><img src="TQ05-performance-analysis-with-tidyquant_files/figure-html/unnamed-chunk-46-1.png" width="95%" style="display: block; margin: auto;"></p>
<p>Finally, taking this one step further, we apply the same process to
the “Multiple Portfolio” example:</p>
<ol style="list-style-type: decimal">
<li>50% AAPL, 25% GOOG, 25% NFLX</li>
<li>25% AAPL, 50% GOOG, 25% NFLX</li>
<li>25% AAPL, 25% GOOG, 50% NFLX</li>
</ol>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">portfolio_growth_monthly_multi</span> <span class="op">&lt;-</span> <span class="va">stock_returns_monthly_multi</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_portfolio.html">tq_portfolio</a></span><span class="op">(</span>assets_col   <span class="op">=</span> <span class="va">symbol</span>, </span>
<span>                 returns_col  <span class="op">=</span> <span class="va">Ra</span>, </span>
<span>                 weights      <span class="op">=</span> <span class="va">weights_table</span>, </span>
<span>                 col_rename   <span class="op">=</span> <span class="st">"investment.growth"</span>,</span>
<span>                 wealth.index <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>investment.growth <span class="op">=</span> <span class="va">investment.growth</span> <span class="op">*</span> <span class="fl">10000</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">portfolio_growth_monthly_multi</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">investment.growth</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">portfolio</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Portfolio Growth"</span>,</span>
<span>         subtitle <span class="op">=</span> <span class="st">"Comparing Multiple Portfolios"</span>,</span>
<span>         caption <span class="op">=</span> <span class="st">"Portfolio 3 is a Standout!"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Portfolio Value"</span>,</span>
<span>         color <span class="op">=</span> <span class="st">"Portfolio"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/theme_tq.html">theme_tq</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/scale_manual.html">scale_color_tq</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/dollar_format.html" class="external-link">dollar</a></span><span class="op">)</span></span></code></pre></div>
<p><img src="TQ05-performance-analysis-with-tidyquant_files/figure-html/unnamed-chunk-48-1.png" width="95%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="customizing-tq_performance">5.2 Customizing tq_performance<a class="anchor" aria-label="anchor" href="#customizing-tq_performance"></a>
</h3>
<p>Finally, the same concept of passing arguments works with all the
<code>tidyquant</code> functions that are wrappers including
<code>tq_transmute</code>, <code>tq_mutate</code>,
<code>tq_performance</code>, etc. Let’s use a final example with the
<code>SharpeRatio</code>, which has the following arguments.</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/args.html" class="external-link">args</a></span><span class="op">(</span><span class="va">SharpeRatio</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## function (R, Rf = 0, p = 0.95, FUN = c("StdDev", "VaR", "ES"), </span></span>
<span><span class="co">##     weights = NULL, annualize = FALSE, SE = FALSE, SE.control = NULL, </span></span>
<span><span class="co">##     ...) </span></span>
<span><span class="co">## NULL</span></span></code></pre>
<p>We can see that the parameters <code>Rf</code> allows us to apply a
risk-free rate and <code>p</code> allows us to vary the confidence
interval. Let’s compare the Sharpe ratio with an annualized risk-free
rate of 3% and a confidence interval of 0.99.</p>
<p>Default:</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RaRb_multiple_portfolio</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_performance.html">tq_performance</a></span><span class="op">(</span>Ra              <span class="op">=</span> <span class="va">Ra</span>, </span>
<span>                   performance_fun <span class="op">=</span> <span class="va">SharpeRatio</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   portfolio [3]</span></span></span>
<span><span class="co">##   portfolio ESSharpe(Rf=0%,p=95%…¹ StdDevSharpe(Rf=0%,p…² VaRSharpe(Rf=0%,p=95…³</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         1                  0.172                  0.355                  0.263</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         2                  0.146                  0.334                  0.236</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>         3                  0.150                  0.317                  0.238</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ abbreviated names: ¹​`ESSharpe(Rf=0%,p=95%)`, ²​`StdDevSharpe(Rf=0%,p=95%)`,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   ³​`VaRSharpe(Rf=0%,p=95%)`</span></span></span></code></pre>
<p>With <code>Rf = 0.03 / 12</code> (adjusted for monthly
periodicity):</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RaRb_multiple_portfolio</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_performance.html">tq_performance</a></span><span class="op">(</span>Ra              <span class="op">=</span> <span class="va">Ra</span>, </span>
<span>                   performance_fun <span class="op">=</span> <span class="va">SharpeRatio</span>,</span>
<span>                   Rf              <span class="op">=</span> <span class="fl">0.03</span> <span class="op">/</span> <span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   portfolio [3]</span></span></span>
<span><span class="co">##   portfolio ESSharpe(Rf=0.2%,p=9…¹ StdDevSharpe(Rf=0.2%…² VaRSharpe(Rf=0.2%,p=…³</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         1                  0.157                  0.325                  0.241</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         2                  0.134                  0.305                  0.216</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>         3                  0.141                  0.296                  0.222</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ abbreviated names: ¹​`ESSharpe(Rf=0.2%,p=95%)`,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   ²​`StdDevSharpe(Rf=0.2%,p=95%)`, ³​`VaRSharpe(Rf=0.2%,p=95%)`</span></span></span></code></pre>
<p>And, with both <code>Rf = 0.03 / 12</code> (adjusted for monthly
periodicity) and <code>p = 0.99</code>:</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RaRb_multiple_portfolio</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/tq_performance.html">tq_performance</a></span><span class="op">(</span>Ra              <span class="op">=</span> <span class="va">Ra</span>, </span>
<span>                   performance_fun <span class="op">=</span> <span class="va">SharpeRatio</span>,</span>
<span>                   Rf              <span class="op">=</span> <span class="fl">0.03</span> <span class="op">/</span> <span class="fl">12</span>, </span>
<span>                   p               <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   portfolio [3]</span></span></span>
<span><span class="co">##   portfolio ESSharpe(Rf=0.2%,p=9…¹ StdDevSharpe(Rf=0.2%…² VaRSharpe(Rf=0.2%,p=…³</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         1                 0.105                   0.325                  0.134</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         2                 0.095<span style="text-decoration: underline;">2</span>                  0.305                  0.115</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>         3                 0.091<span style="text-decoration: underline;">5</span>                  0.296                  0.117</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ abbreviated names: ¹​`ESSharpe(Rf=0.2%,p=99%)`,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   ²​`StdDevSharpe(Rf=0.2%,p=99%)`, ³​`VaRSharpe(Rf=0.2%,p=99%)`</span></span></span></code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matt Dancho, Davis Vaughan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
